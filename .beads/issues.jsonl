{"id":"LMS_StreamTest-139","title":"Phase 5: Implement Sync Group Persistence","description":"Parse 10-byte sync group ID from serv packet. Store in UserDefaults and include in HELO reconnects. Files: SlimProtoCoordinator.swift, SettingsManager.swift","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-01T20:32:50.939972-05:00","updated_at":"2025-12-01T20:53:31.020556-05:00","closed_at":"2025-12-01T20:53:31.020556-05:00","dependencies":[{"issue_id":"LMS_StreamTest-139","depends_on_id":"LMS_StreamTest-87x","type":"blocks","created_at":"2025-12-01T20:33:02.998259-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-1us","title":"Phase 7.1: Study StreamDecoder Architecture","description":"Understand current push stream implementation. Read StreamDecoder.swift to understand: 1) How push streams buffer data, 2) BASS_StreamPutData usage, 3) Playback start/pause mechanics, 4) Current buffer management. Document findings for sync integration planning. Files: StreamDecoder.swift","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-01T20:56:39.162135-05:00","updated_at":"2025-12-01T20:58:29.084918-05:00","closed_at":"2025-12-01T20:58:29.084918-05:00"}
{"id":"LMS_StreamTest-244","title":"Phase 2: Implement strm 'u' Unpause with Timing","description":"Parse strm 'u' command and extract jiffies from replay_gain field. Route to AudioPlayer.startAt() for delayed start or immediate resume. Files: SlimProtoCommandHandler.swift","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-01T20:32:50.606929-05:00","updated_at":"2025-12-01T20:40:03.54217-05:00","closed_at":"2025-12-01T20:40:03.54217-05:00","dependencies":[{"issue_id":"LMS_StreamTest-244","depends_on_id":"LMS_StreamTest-5uz","type":"blocks","created_at":"2025-12-01T20:33:02.875434-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-387","title":"Phase 5A: Implement fallback settings access for WebView auth lockout","description":"Implement fallback settings access to prevent authentication lockout in WebView.\n\nCRITICAL UX ISSUE:\nIf user enters wrong LMS credentials, WebView fails and JavaScript-injected settings button never loads, creating lockout.\n\nSOLUTION - CONDITIONAL FALLBACK UI:\n\nNormal Operation (Auth Working):\n- WebView loads successfully\n- Material UI shows integrated settings button (JavaScript injection)\n- NO floating gear icon - clean UI\n\nError States (Show Fallback):\n- WebView 401/404 auth error ‚Üí Show native fallback UI\n- WebView timeout/network error ‚Üí Show native fallback UI  \n- Server unreachable ‚Üí Show native fallback UI\n\nFallback UI Components:\n1. Native error view with clear message\n2. \"Open Settings\" button (native, always works)\n3. Optional: Subtle floating gear icon overlay (only on error states)\n\nImplementation Details:\n- Update WebView Coordinator to detect 401 in didFailProvisionalNavigation\n- Show error state view when WebView fails (hasConnectionError = true)\n- Error view includes native \"Settings\" button that bypasses WebView\n- Once WebView loads successfully, hide error view (use normal Material UI)\n- Floating gear (if implemented) only visible when hasConnectionError == true\n\nUser Flow on Auth Failure:\n1. User enters wrong password\n2. WebView fails to load with 401\n3. Error view appears: \"Authentication Failed - Cannot connect to LMS server\"\n4. Native \"Open Settings\" button visible (NOT in WebView)\n5. User taps button ‚Üí Opens native settings sheet\n6. User fixes credentials ‚Üí Saves\n7. Settings dismisses ‚Üí Reconnects\n8. WebView loads successfully ‚Üí Error view hidden\n9. Material UI settings button now works normally\n\nFiles to Modify:\n- ContentView.swift (WebView error handling, conditional error view)\n- ContentView.swift (serverErrorView - enhance with native settings button)\n\nUX PRINCIPLE: Only show fallback UI when normal UI is broken","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T06:29:03.225307-05:00","updated_at":"2025-12-07T06:59:08.588432-05:00","closed_at":"2025-12-07T06:59:08.588432-05:00","dependencies":[{"issue_id":"LMS_StreamTest-387","depends_on_id":"LMS_StreamTest-hqs","type":"blocks","created_at":"2025-12-07T06:29:06.172399-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-3xu","title":"Phase 7: Implement Push Stream Synchronization Support","description":"CRITICAL: Extend StreamDecoder to support synchronized playback. LyrPlay uses ONLY push streams - URL stream sync (Phases 3-4) doesn't apply. Must implement: 1) Delayed start for push streams, 2) Timed pause (silence injection), 3) Skip ahead (buffer consumption). Files: StreamDecoder.swift, AudioManager.swift","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-01T20:56:17.555743-05:00","updated_at":"2025-12-07T14:36:57.147474-05:00","closed_at":"2025-12-07T14:36:57.147474-05:00","dependencies":[{"issue_id":"LMS_StreamTest-3xu","depends_on_id":"LMS_StreamTest-1us","type":"parent-child","created_at":"2025-12-01T20:56:47.913539-05:00","created_by":"daemon"},{"issue_id":"LMS_StreamTest-3xu","depends_on_id":"LMS_StreamTest-db0","type":"parent-child","created_at":"2025-12-01T20:56:47.947128-05:00","created_by":"daemon"},{"issue_id":"LMS_StreamTest-3xu","depends_on_id":"LMS_StreamTest-ceb","type":"parent-child","created_at":"2025-12-01T20:56:47.981631-05:00","created_by":"daemon"},{"issue_id":"LMS_StreamTest-3xu","depends_on_id":"LMS_StreamTest-77b","type":"parent-child","created_at":"2025-12-01T20:56:48.014706-05:00","created_by":"daemon"},{"issue_id":"LMS_StreamTest-3xu","depends_on_id":"LMS_StreamTest-512","type":"parent-child","created_at":"2025-12-01T20:56:48.047853-05:00","created_by":"daemon"},{"issue_id":"LMS_StreamTest-3xu","depends_on_id":"LMS_StreamTest-c4i","type":"parent-child","created_at":"2025-12-01T20:56:48.08128-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-3xu.1","title":"Phase 7.7: Implement STMl Buffer Ready Signaling","description":"Add STMl status message when buffer is ready for sync. Implementation: 1) Add sentSTMl flag to AudioStreamDecoder, 2) Check buffer level in decoder loop (2-3 seconds buffered), 3) Add delegate method audioStreamDecoderBufferReady(), 4) SlimProtoCoordinator sends STMl on callback, 5) Reset sentSTMl when starting new track. This tells server 'buffer loaded and ready for synchronized start'. Files: AudioStreamDecoder.swift, SlimProtoCoordinator.swift","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-01T21:37:46.02853-05:00","updated_at":"2025-12-01T21:40:55.212523-05:00","closed_at":"2025-12-01T21:40:55.212523-05:00","dependencies":[{"issue_id":"LMS_StreamTest-3xu.1","depends_on_id":"LMS_StreamTest-3xu","type":"parent-child","created_at":"2025-12-01T21:37:46.028869-05:00","created_by":"daemon"},{"issue_id":"LMS_StreamTest-3xu.1","depends_on_id":"LMS_StreamTest-c4i","type":"blocks","created_at":"2025-12-01T21:37:46.029279-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-48y","title":"Phase 1A: Research all BASS streaming modes for auth compatibility","description":"Investigate and document all BASS streaming modes to ensure authentication headers work everywhere.\n\nCRITICAL RESEARCH NEEDED:\nUser reports two streaming modes exist:\n1. Old URL streaming (legacy FLAC workaround)\n2. Push streaming (gapless playback)\n\nTasks:\n1. Search codebase for ALL BASS_StreamCreateURL calls\n2. Search for BASS_StreamCreate (push stream with STREAMPROC)\n3. Identify where FLAC auto-routing decision is made\n4. Document all audio stream creation paths\n5. Verify auth header mechanism works for BOTH modes\n\nFiles to Investigate:\n- AudioPlayer.swift (all stream creation functions)\n- SlimProtoCommandHandler.swift (STRM command handling)\n- CLAUDE.md (references to \"FLAC Auto-Routing\" and \"legacy URL streaming\")\n\nExpected Findings:\n- List all stream creation entry points\n- Document differences between modes\n- Identify if BASS_CONFIG_NET_AGENT works for both\n- Alternative: custom DOWNLOADPROC if needed for one mode\n\nDeliverable:\n- Technical document listing all streaming paths\n- Recommendation for where to inject auth headers","notes":"CRITICAL DISCOVERY - BASS does NOT support custom HTTP headers!\n\nINITIAL ASSUMPTION (WRONG):\n‚ùå Use BASS_SetConfigPtr(BASS_CONFIG_NET_AGENT) to inject Authorization headers\n‚ùå BASS_CONFIG_NET_AGENT would apply to all BASS_StreamCreateURL calls\n\nACTUAL FINDINGS:\n‚úÖ BASS_CONFIG_NET_AGENT is for User-Agent header ONLY\n‚úÖ BASS has NO built-in support for custom HTTP headers\n‚úÖ Attempting to use it for Authorization caused crashes (EXC_BAD_ACCESS)\n\nCORRECT APPROACH (from LMS documentation):\n‚úÖ LMS supports URL-embedded credentials: http://username:password@server:port/stream.mp3\n‚úÖ Documented in slimserver/HTML/EN/html/docs/remotestreaming.html:\n   \"If you are using the server's password security, you'll need to use a \n    slightly modified URL like this: http://username:password@localhost:9000/stream.mp3\"\n‚úÖ BASS supports standard HTTP URL credentials automatically\n\nSTREAMING ARCHITECTURE (confirmed):\nBoth streaming modes use BASS_StreamCreateURL():\n1. AudioStreamDecoder:610 - decode-only for gapless playback\n2. AudioPlayer:942 - direct playback mode\n\nURL credential injection works for BOTH because it's done BEFORE the URL reaches BASS.\n\nIMPLEMENTATION:\n- SettingsManager.injectCredentialsIntoURL() modifies stream URLs\n- SlimProtoCommandHandler calls this before passing URL to AudioPlayer\n- URLComponents safely handles special characters in username/password\n- No BASS configuration changes needed\n\nLMS SERVER VALIDATION:\n- slimserver/Slim/Web/HTTP.pm validates HTTP Basic Auth for ALL requests\n- checkAuthorization() function (line 2550) validates credentials\n- Works for both WebView access AND stream URLs\n- Server returns 401 WWW-Authenticate if auth fails\n\nUPDATED CLAUDE.md:\n- Removed \"FLAC Auto-Routing\" references (no longer exists)\n- Updated to \"Unified Gapless Architecture\" \n- All formats use push stream architecture","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T06:29:00.913816-05:00","updated_at":"2025-12-07T07:45:21.950624-05:00","closed_at":"2025-12-07T06:35:14.379367-05:00"}
{"id":"LMS_StreamTest-4ds","title":"Test: Server auth changes and connection errors unaffected","description":"Verify that changing server authentication in Settings properly reconnects with new credentials. Also verify that connection error popups (hasConnectionError, loadError) still display correctly when server is unreachable or auth fails.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T19:36:42.417338-05:00","updated_at":"2025-12-08T19:45:41.745033-05:00","closed_at":"2025-12-08T19:45:41.745033-05:00","dependencies":[{"issue_id":"LMS_StreamTest-4ds","depends_on_id":"LMS_StreamTest-9pe","type":"blocks","created_at":"2025-12-08T19:36:55.556373-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-512","title":"Phase 7.5: Update AudioManager Push Stream Routing","description":"Remove push stream fallback warnings and route to StreamDecoder sync methods. Update AudioManager.swift: 1) Remove 'Push streams don't support' error logs, 2) Route startAtJiffies to streamDecoder.startAtJiffies(), 3) Route playSilence to streamDecoder.playSilence(), 4) Route skipAhead to streamDecoder.skipAhead(). Files: AudioManager.swift","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-01T20:56:39.739761-05:00","updated_at":"2025-12-01T21:09:28.079155-05:00","closed_at":"2025-12-01T21:09:28.079155-05:00","dependencies":[{"issue_id":"LMS_StreamTest-512","depends_on_id":"LMS_StreamTest-77b","type":"blocks","created_at":"2025-12-01T20:56:48.302861-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-5uz","title":"Phase 1: Implement Jiffies Epoch Tracking","description":"Add jiffiesEpoch and jiffiesOffsetList tracking to SlimProtoCoordinator. Update epoch on every STAT received with drift correction using offset list (max 8 entries). Files: SlimProtoCoordinator.swift","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-01T20:32:50.494905-05:00","updated_at":"2025-12-01T20:36:42.225743-05:00","closed_at":"2025-12-01T20:36:42.225743-05:00"}
{"id":"LMS_StreamTest-60n","title":"Phase 6: Handle 401 Unauthorized responses gracefully","description":"Add graceful handling of HTTP 401 Unauthorized responses from LMS servers.\n\nImplementation Details:\n- Monitor BASS stream creation errors for HTTP 401\n- Parse HTTP response codes from BASS error callbacks\n- Show user-friendly alert when credentials are invalid\n- Suggest checking username/password in settings\n- Add retry mechanism with credential prompt\n- Update connection test to validate authentication\n- Log authentication failures for debugging\n\nError Messages:\n- \"Authentication failed. Please check username and password in Settings\"\n- \"Server requires authentication. Please enter credentials in Server Configuration\"\n\nFiles to Modify:\n- LMS_StreamTest/AudioPlayer.swift (error handling)\n- LMS_StreamTest/SlimProtoCoordinator.swift (connection handling)\n- LMS_StreamTest/SettingsManager.swift (connection test)\n\nDependencies:\n- Requires AudioPlayer auth implementation (Phase 4)","notes":"Phase 6 may not be necessary with URL-embedded credentials approach.\n\nREASON:\nWith URL-embedded credentials (http://user:pass@host/path), authentication happens at the HTTP protocol level BEFORE BASS gets the stream data. BASS doesn't expose HTTP status codes - it only reports \"stream creation success\" or \"generic network failure.\"\n\nWHAT WE ALREADY HAVE:\n‚úÖ WebView 401 Detection (Phase 5A) - ContentView.swift handles NSURLErrorDomain code -1012\n‚úÖ User-friendly error messages for WebView authentication failures\n‚úÖ Fallback settings button when WebView fails to load\n\nSTREAM URL BEHAVIOR:\n- Correct credentials ‚Üí BASS successfully creates stream ‚Üí audio plays\n- Wrong credentials ‚Üí HTTP 401 ‚Üí BASS fails stream creation with generic network error\n- Cannot distinguish \"401 auth failure\" from \"server down\" or \"network issue\" at BASS level\n\nBASS LIMITATIONS:\n- BASS_StreamCreateURL() returns 0 on ANY network failure\n- BASS_ErrorGetCode() returns generic error codes (not HTTP-specific)\n- No HTTP response code exposure in BASS API\n- URL-embedded auth is transparent to BASS (handled by HTTP layer)\n\nCURRENT ERROR HANDLING:\nAudioPlayer already logs stream creation failures:\n- \"Failed to create stream: [generic BASS error]\"\n- \"Stream error detected: [error code]\"\n- These cover auth failures (they just look like network errors)\n\nRECOMMENDATION:\nPhase 6 implementation would require:\n1. Custom HTTP layer to intercept 401 responses BEFORE passing to BASS\n2. Significant architectural changes to AudioPlayer/SlimProtoCommandHandler\n3. Complexity without clear user benefit (they'll see \"stream failed\" either way)\n\nBETTER APPROACH:\n1. Test Phase 7 with wrong credentials to see actual user experience\n2. If stream failures with wrong auth are unclear, add guidance:\n   \"Stream failed to load. If your server requires authentication, check Settings.\"\n3. Connection test in settings could validate auth before attempting playback\n\nCONCLUSION:\nPhase 6 as originally scoped (monitoring BASS errors for 401) is not feasible with URL-embedded credentials. The HTTP 401 happens below BASS's visibility. Consider Phase 6 complete via Phase 5A (WebView 401 handling), or rescope to add connection testing.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T06:21:44.97835-05:00","updated_at":"2025-12-07T12:34:49.500056-05:00","closed_at":"2025-12-07T12:34:49.500056-05:00","dependencies":[{"issue_id":"LMS_StreamTest-60n","depends_on_id":"LMS_StreamTest-afv","type":"blocks","created_at":"2025-12-07T06:22:02.651678-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-6tc","title":"Wake On LAN support","description":"User requests Wake On LAN functionality to wake sleeping Lyrion server from the app.\n\nTechnical considerations:\n- iOS apps have network restrictions that may limit WOL packet broadcasting\n- May require local network permissions and user configuration\n- Need to discover and store server MAC addresses\n- Could integrate with existing server discovery system\n\nNote: Feasibility needs investigation - iOS networking limitations may prevent reliable WOL implementation.\n\nGitHub issue: #38\nAuthor: wiredcharlie\nOpened: Oct 18, 2025\n\nPriority: Low - Nice-to-have feature, technical feasibility uncertain","status":"open","priority":4,"issue_type":"feature","created_at":"2025-11-30T14:59:59.940071-05:00","updated_at":"2025-11-30T14:59:59.940071-05:00","external_ref":"gh-38"}
{"id":"LMS_StreamTest-77b","title":"Phase 7.4: Implement Buffer Skip Ahead for Push Streams","description":"Add skip ahead (consume buffer) to StreamDecoder. For drift correction when player is behind. Implementation: 1) Add skipAhead(duration:) method, 2) Calculate bytes to skip based on duration and sample rate, 3) Discard buffered data by not calling BASS_StreamPutData, 4) Track skipped bytes to maintain position. Files: StreamDecoder.swift","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-01T20:56:39.600713-05:00","updated_at":"2025-12-01T21:07:43.327121-05:00","closed_at":"2025-12-01T21:07:43.327121-05:00","dependencies":[{"issue_id":"LMS_StreamTest-77b","depends_on_id":"LMS_StreamTest-ceb","type":"blocks","created_at":"2025-12-01T20:56:48.268047-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-7oi","title":"Phase 1: Create KeychainManager for secure credential storage","description":"Create a new KeychainManager.swift class that provides secure storage for username/password credentials using iOS Keychain Services API.\n\nImplementation Details:\n- Create KeychainManager.swift with Security framework import\n- Implement save(username:password:serverKey:) method\n- Implement load(serverKey:) -\u003e (username:password?) method\n- Implement delete(serverKey:) method\n- Use kSecClassGenericPassword for credential storage\n- Support both primary and backup server credentials via serverKey\n- Add proper error handling and logging\n\nFiles to Create:\n- LMS_StreamTest/Managers/KeychainManager.swift","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T06:20:37.384237-05:00","updated_at":"2025-12-07T06:39:11.411292-05:00","closed_at":"2025-12-07T06:39:11.411292-05:00"}
{"id":"LMS_StreamTest-87x","title":"Phase 4: Implement Sync Drift Corrections","description":"Handle strm 'p' (timed pause - play silence) and strm 'a' (skip ahead - consume buffer). Extract interval from replay_gain field. Files: SlimProtoCommandHandler.swift, AudioPlayer.swift","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-01T20:32:50.836893-05:00","updated_at":"2025-12-01T20:48:13.745477-05:00","closed_at":"2025-12-01T20:48:13.745477-05:00","dependencies":[{"issue_id":"LMS_StreamTest-87x","depends_on_id":"LMS_StreamTest-owe","type":"blocks","created_at":"2025-12-01T20:33:02.957686-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-8fs","title":"Phase 2: Update SettingsManager with authentication properties","description":"Add username/password properties to SettingsManager and integrate with KeychainManager for secure storage.\n\nImplementation Details:\n- Add @Published var serverUsername: String = \"\"\n- Add @Published var serverPassword: String = \"\"\n- Add @Published var backupServerUsername: String = \"\"\n- Add @Published var backupServerPassword: String = \"\"\n- Integrate KeychainManager for credential persistence\n- Update loadSettings() to fetch credentials from Keychain\n- Update saveSettings() to store credentials in Keychain\n- Add computed property hasAuthentication: Bool for both servers\n- Add activeServerUsername/activeServerPassword computed properties\n\nFiles to Modify:\n- LMS_StreamTest/SettingsManager.swift\n\nDependencies:\n- Requires KeychainManager (Phase 1)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T06:21:34.965277-05:00","updated_at":"2025-12-07T06:44:07.885522-05:00","closed_at":"2025-12-07T06:44:07.885522-05:00","dependencies":[{"issue_id":"LMS_StreamTest-8fs","depends_on_id":"LMS_StreamTest-7oi","type":"blocks","created_at":"2025-12-07T06:22:02.122469-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-9f2","title":"-","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T14:44:06.051305-05:00","updated_at":"2025-12-10T06:07:00.240019-05:00","closed_at":"2025-12-10T06:07:00.240019-05:00"}
{"id":"LMS_StreamTest-9fl","title":"Investigate USB DAC reinit not working - testers report issues","description":"## Issue Report\n\nTesters report that BASS_DEVICE_REINIT implementation (build 7) is not working correctly with USB DACs.\n\n## What We Implemented (Build 7)\n\nCode in AudioStreamDecoder.swift:636-686:\n1. Check device rate with BASS_GetInfo()\n2. If mismatch with stream rate, call BASS_Init with BASS_DEVICE_REINIT\n3. Verify final device rate\n\n## Potential Issues to Check\n\n### 1. Initial BASS_Init Might Block Reinit\n\n**AudioPlayer.swift:145** initializes BASS once at 48kHz:\n\\`\\`\\`swift\nlet targetRate: DWORD = 48000\nlet result = BASS_Init(-1, targetRate, DWORD(BASS_DEVICE_FREQ), nil, nil)\n\\`\\`\\`\n\n**Question**: Does initial BASS_Init with BASS_DEVICE_FREQ lock the device at 48kHz?\n\n### 2. Missing BASS_DEVICE_FREQ on Reinit?\n\n**AudioStreamDecoder.swift:651** does reinit with:\n\\`\\`\\`swift\nBASS_Init(-1, DWORD(actualSampleRate), DWORD(BASS_DEVICE_FREQ | BASS_DEVICE_REINIT), nil, nil)\n\\`\\`\\`\n\nThis looks correct - has both flags.\n\n### 3. iOS Session Rate Conflict?\n\n**PlaybackSessionController.swift:156** sets:\n\\`\\`\\`swift\ntry session.setPreferredSampleRate(48000)\n\\`\\`\\`\n\n**Question**: Does iOS AVAudioSession lock prevent BASS from changing hardware rate?\n\n### 4. Timing Issue?\n\nMaybe BASS_DEVICE_REINIT needs to happen BEFORE creating the stream decoder, not during startDecodingFromURL()?\n\n## Debug Steps Needed\n\n1. **Add logging before/after BASS_Init** to see if initial init locks device\n2. **Check BASS_ErrorGetCode** when BASS_DEVICE_REINIT fails\n3. **Test without AVAudioSession.setPreferredSampleRate** to see if iOS is blocking\n4. **Move reinit earlier** - try before decoder creation instead of during stream start\n\n## Questions for un4seen Forum\n\n1. Does initial BASS_Init with BASS_DEVICE_FREQ lock the device rate?\n2. Can BASS_DEVICE_REINIT change from 48kHz‚Üí96kHz‚Üí192kHz dynamically?\n3. Does iOS AVAudioSession.preferredSampleRate interfere with BASS rate changes?\n4. Should we NOT use BASS_DEVICE_FREQ on initial init, only on BASS_DEVICE_REINIT?\n\n## Test Logs Needed from Testers\n\n- What does app log show for device reinit?\n- What sample rate does DAC display show?\n- What does iOS Audio MIDI Setup show for the device?\n- Does it work for ANY high-res file or completely fails?","notes":"## Ian's Response (Forum Topic 20831)\n\n**Forum Link:** https://www.un4seen.com/forum/?topic=20831.0\n\nIan confirmed the correct approach for iOS bit-perfect playback:\n\n### Recommended Method: AVAudioSession.setPreferredSampleRate\n\n**Quote from Ian:**\n\u003e \"You can use AVAudioSession to set the sample rate, eg:\n\u003e [[AVAudioSession sharedInstance] setPreferredSampleRate:chaninfo.freq error:nil];\n\u003e \n\u003e BASS will also detect when the output rate is changed.\"\n\n### Implementation Updated (AudioStreamDecoder.swift:636-676)\n\n**What Changed:**\n- ‚ùå Removed BASS_DEVICE_REINIT approach (was correct but not iOS-preferred)\n- ‚úÖ Now using AVAudioSession.setPreferredSampleRate per Ian's guidance\n- ‚úÖ BASS automatically detects the rate change - no manual reinit needed\n\n**New Code Flow:**\n1. Check current iOS session sample rate\n2. If mismatch with content, call setPreferredSampleRate\n3. BASS detects the change automatically\n4. Verify final rates with BASS_GetInfo + AVAudioSession\n\n**Benefits:**\n- Simpler than BASS_DEVICE_REINIT\n- iOS-native approach\n- BASS handles detection automatically\n- Works with external DACs that support rate switching\n\n### Testing Needed\n\nRebuild and test with USB DAC:\n- 96kHz FLAC ‚Üí DAC should show 96kHz\n- 192kHz FLAC ‚Üí DAC should show 192kHz  \n- 44.1kHz MP3 ‚Üí DAC should show 44.1kHz\n- Built-in speaker ‚Üí Should gracefully report 48kHz limitation\n\nCheck console logs for:\n- ‚úÖ \"Bit-perfect playback: XXHz ‚Üí XXHz\"\n- ‚ÑπÔ∏è \"Device limited to 48kHz\" (for built-in audio)","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-13T08:08:24.402492-05:00","updated_at":"2025-12-14T19:48:07.639169-05:00","closed_at":"2025-12-14T19:48:07.639169-05:00","labels":["tester-feedback","usb-dac"]}
{"id":"LMS_StreamTest-9j2","title":"CarPlay album selection should show track list before playing","description":"## Problem\n\nWhen selecting an album from CarPlay home screen (New Music or Random Releases rows), the album starts playing immediately. This is inconsistent with playlist behavior which shows a track list first.\n\n## Expected Behavior\n\n1. Tap album from New Music/Random Releases row\n2. See list of tracks in album (like playlist track view)\n3. Option to 'Play All' at top\n4. Tap individual track to start playing from that position\n\n## Current Behavior\n\n- Tap album ‚Üí immediately starts playing from track 1\n- No visibility into what tracks are in the album\n- No way to start from specific track\n\n## Solution\n\nImplement album track list view similar to existing playlist track list:\n- Fetch album tracks via JSON-RPC\n- Display track list with artwork\n- 'Play All' option at top\n- Individual track selection starts album from that position\n\n## Files to Modify\n\n- CarPlaySceneDelegate.swift\n  - Modify playAlbum() to show track list first\n  - Add fetchAlbumTracks() method\n  - Add displayAlbumTracks() method\n  - Add playAlbumTrack() method","notes":"## Implementation Complete - PENDING TESTING\n\nAdded album track list view to CarPlay, matching the playlist behavior.\n\n### Changes Made (CarPlaySceneDelegate.swift)\n\n**1. Modified playAlbum() (Lines 1460-1477)**\n- Changed from immediate playback to showing track list\n- Fetches album tracks first via fetchAlbumTracks()\n- Falls back to direct album load if no tracks found\n\n**2. Added fetchAlbumTracks() (Lines 1479-1557)**\n- Uses LMS 'titles' query with album_id filter\n- Tags: d=duration, a=artist, l=album, C=coverid, t=tracknum\n- Parses titles_loop response into PlaylistTrack objects\n- Reuses existing PlaylistTrack model for consistency\n\n**3. Added displayAlbumTracks() (Lines 1559-1629)**\n- Shows 'Play All' option at top with album artwork\n- Lists individual tracks with:\n  - Track title\n  - Track number, artist, duration in detail text\n  - Track or album artwork\n- CarPlay 25 track limit for performance\n- Uses existing loadArtworkForTracks() for artwork loading\n\n**4. Added playAlbumTrack() (Lines 1631-1661)**\n- Uses playlistcontrol with play_index parameter\n- Starts album playback from selected track position\n- Pushes to Now Playing template after load\n\n**5. Added loadAlbumDirectly() (Lines 1663-1692)**\n- 'Play All' action handler\n- Loads and plays entire album from beginning\n- Error handling with user feedback\n\n### User Experience\n\n**Before:**\n- Tap album ‚Üí immediately starts playing track 1\n- No way to see track list\n- No way to start from specific track\n\n**After:**\n- Tap album ‚Üí see list of tracks with artwork\n- 'Play All' at top to play entire album\n- Tap any track to start album from that position\n- Consistent with playlist behavior\n\n### Testing Checklist\n- [ ] Tap album from New Music row ‚Üí track list appears\n- [ ] Tap album from Random Releases row ‚Üí track list appears\n- [ ] 'Play All' starts album from track 1\n- [ ] Tapping track 5 starts album from track 5\n- [ ] Track artwork displays correctly\n- [ ] Track durations display correctly\n- [ ] Back button returns to home screen\n- [ ] Now Playing shows after selection\n\n### Code Status\n‚úÖ Implementation complete\n‚úÖ Compiles successfully  \n‚è≥ Awaiting real-world CarPlay testing","status":"open","priority":1,"issue_type":"feature","created_at":"2025-12-17T22:26:55.199772-05:00","updated_at":"2025-12-17T22:29:04.658448-05:00"}
{"id":"LMS_StreamTest-9pe","title":"Implement previous server value tracking to prevent startup reconnection","description":"Add @State private var previousActiveServer: ServerType? to ContentView.swift. Modify .onReceive(settings.$currentActiveServer) handler to skip first fire (initial subscription) and only reconnect when server actually changes. This preserves manual switch functionality while eliminating unnecessary startup reconnection.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-08T19:36:13.472616-05:00","updated_at":"2025-12-08T19:43:35.457419-05:00","closed_at":"2025-12-08T19:43:35.457419-05:00","dependencies":[{"issue_id":"LMS_StreamTest-9pe","depends_on_id":"LMS_StreamTest-af6","type":"blocks","created_at":"2025-12-08T19:36:51.171917-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-9up","title":"Phase 6: Test and Verify Synchronization Implementation","description":"Test Phases 1, 2, 5 which work with push streams. Verify: 1) Jiffies epoch tracking logs, 2) strm u/p/a command parsing (not execution), 3) Sync group persistence. Document that Phases 3-4 need push stream implementation. This is TESTING ONLY - sync won't actually work until Phase 7 completes.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-01T20:55:20.595882-05:00","updated_at":"2025-12-07T14:37:00.516834-05:00","closed_at":"2025-12-07T14:37:00.516834-05:00"}
{"id":"LMS_StreamTest-9x6","title":"Multi-track FLAC files only play first track","description":"Multi-track FLAC files only play the first track. When browsing, all tracks show correctly, but:\n\n- Hitting play only plays first track\n- 'Play Next' does nothing - time display flashes at 0:01\n- Single-track FLAC files play fine\n- Other LMS clients (squeezelite) handle multi-track FLAC correctly\n\nEnvironment:\n- iOS version: 26.1\n- LyrPlay version: 1.6.2\n- User's local music library consists mostly of multi-track FLAC files\n\nThis appears to be a BASS/FLAC parsing issue where multi-track FLAC files aren't being handled properly in the audio pipeline.\n\nGitHub issue: #48\nAuthor: david2005it\nOpened: Nov 23, 2025\n\nPriority: High - affects core playback functionality for users with multi-track FLAC libraries","status":"open","priority":1,"issue_type":"bug","created_at":"2025-11-30T14:56:29.912656-05:00","updated_at":"2025-11-30T14:56:29.912656-05:00","external_ref":"gh-48"}
{"id":"LMS_StreamTest-af6","title":"Fix unnecessary reconnection cycles on app startup","description":"COMPLETE ANALYSIS:\n\n## Current Behavior\nThe `.onReceive(settings.$currentActiveServer)` handler (ContentView.swift:244-267) fires in 4 scenarios:\n\n1. **Initial App Startup** (PROBLEMATIC ‚ùå)\n   - SettingsManager loads currentActiveServer from UserDefaults\n   - .onReceive fires on subscription ‚Üí UNNECESSARY reconnect\n\n2. **Automatic Failover to Backup** (REDUNDANT ‚ùå)\n   - Failover code (SlimProtoCoordinator:581) calls switchToBackupServer()\n   - Failover updates client settings + calls client.connect()\n   - .onReceive fires ‚Üí REDUNDANT disconnect/reconnect!\n\n3. **Automatic Failover to Primary** (REDUNDANT ‚ùå)\n   - Failover code (SlimProtoCoordinator:597) calls switchToPrimaryServer()\n   - Failover updates client settings + calls client.connect()\n   - .onReceive fires ‚Üí REDUNDANT disconnect/reconnect!\n\n4. **Manual Server Switch** (NEEDED ‚úÖ)\n   - User clicks Switch button (SettingsView:96)\n   - Calls switchToOtherServer() ‚Üí changes currentActiveServer\n   - RELIES on .onReceive to reconnect (no other mechanism!)\n\n## Root Cause\nSwiftUI's .onReceive() fires IMMEDIATELY on subscription with current value, not just on changes.\n\n## Impact on Other Features\n- ‚úÖ Error handling (hasConnectionError, loadError) - UNAFFECTED\n- ‚úÖ Settings dialog host/port changes - SEPARATE mechanism (sheet onDismiss)\n- ‚úÖ Auth changes - Handled by settings dialog mechanism\n- ‚ö†Ô∏è Manual server switch - Currently DEPENDS on .onReceive handler\n\n## Recommended Solution\nReplace .onReceive with .onChange (iOS 17+) OR track previous value:\n\n**Option 1: Use .onChange (cleaner, only fires on changes)**\n```swift\n.onChange(of: settings.currentActiveServer) { oldValue, newValue in\n    // Only fires on actual changes, not initial subscription\n    os_log(.info, log: logger, \"üîÑ Active server changed: %{public}s ‚Üí %{public}s\", \n           oldValue.displayName, newValue.displayName)\n    \n    // Reload WebView\n    if let webView = webView {\n        let newURL = URL(string: materialWebURL)!\n        let request = URLRequest(url: newURL, cachePolicy: .reloadIgnoringLocalAndRemoteCacheData)\n        webView.load(request)\n    }\n    \n    // Update coordinator tracking\n    slimProtoCoordinator.updateServerSettings(\n        host: settings.activeServerHost,\n        port: UInt16(settings.activeServerSlimProtoPort)\n    )\n    \n    // Reconnect (needed for manual switch, redundant but harmless for failover)\n    Task {\n        await slimProtoCoordinator.restartConnection()\n    }\n}\n```\n\n**Option 2: Track previous value (iOS 15.6+ compatible)**\n```swift\n@State private var previousActiveServer: ServerType?\n\n.onReceive(settings.$currentActiveServer) { newServer in\n    defer { previousActiveServer = newServer }\n    \n    // Skip first fire (initial subscription)\n    guard let previous = previousActiveServer else { return }\n    \n    // Skip if didn't actually change\n    guard previous != newServer else { return }\n    \n    // Server actually switched - reload and reconnect\n    // [same implementation as Option 1]\n}\n```\n\n## Testing Impact\nAfter fix, verify these scenarios still work:\n- [ ] Manual server switch (Settings ‚Üí Switch button) - MUST reconnect\n- [ ] Automatic failover (disconnect primary ‚Üí switches to backup) - May see double reconnect log but works\n- [ ] Settings dialog auth changes - Uses separate mechanism (unaffected)\n- [ ] Can't connect error popup - Triggered by connection failures (unaffected)\n- [ ] Initial app startup - Should connect once, not twice","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-08T19:00:19.056479-05:00","updated_at":"2025-12-08T19:37:42.450979-05:00","closed_at":"2025-12-08T19:37:42.450979-05:00"}
{"id":"LMS_StreamTest-afv","title":"Phase 4: Update AudioPlayer to pass auth headers to BASS","description":"Modify AudioPlayer to include HTTP Basic Auth headers when creating BASS audio streams.\n\nImplementation Details:\n- Update play(url:format:) to accept optional authHeader parameter\n- Use BASS_SetConfigPtr with BASS_CONFIG_NET_AGENT to pass custom headers\n- Format headers as: 'Authorization: Basic \u003cbase64\u003e\\r\\n'\n- Handle both authenticated and non-authenticated streams\n- Test with FLAC, MP3, AAC, Opus formats\n- Ensure headers passed for all BASS_StreamCreateURL calls\n\nBASS API Notes:\n- BASS_CONFIG_NET_AGENT can append custom headers to HTTP requests\n- Headers must end with \\r\\n\n- Alternative: DOWNLOADPROC for complete control over HTTP requests\n\nFiles to Modify:\n- LMS_StreamTest/AudioPlayer.swift\n\nReference:\n- slimserver/Slim/Web/HTTP.pm checkAuthorization()\n\nDependencies:\n- Requires auth header generation (Phase 3)","notes":"IMPLEMENTATION CHANGED - URL-embedded credentials approach\n\nDISCOVERY: BASS_CONFIG_NET_AGENT does NOT support custom HTTP headers!\n- BASS_CONFIG_NET_AGENT is for User-Agent header only\n- Attempting to use it for Authorization headers caused crashes (EXC_BAD_ACCESS)\n- BASS has no built-in support for custom HTTP headers\n\nCORRECT APPROACH (per LMS documentation):\nLMS supports standard HTTP URL-embedded credentials:\n- Format: http://username:password@server:port/stream.mp3\n- Documented in slimserver/HTML/EN/html/docs/remotestreaming.html\n- BASS supports this automatically (standard HTTP)\n\nIMPLEMENTATION:\n‚úÖ Added SettingsManager.injectCredentialsIntoURL() method\n‚úÖ Modified SlimProtoCommandHandler to inject credentials into stream URLs\n‚úÖ Uses URLComponents to safely add .user and .password\n‚úÖ Only injects when hasActiveServerAuthentication is true\n\nCODE LOCATION:\n- SettingsManager.swift:652 - injectCredentialsIntoURL() method\n- SlimProtoCommandHandler.swift:271 - URL injection before stream creation\n\nTESTING NOTES:\n- No BASS configuration needed\n- Works with both AudioPlayer and AudioStreamDecoder\n- Standard HTTP - works with all BASS_StreamCreateURL calls automatically\n- Credentials URL-encoded by URLComponents for special characters\n\nABANDONED APPROACHES:\n‚ùå BASS_SetConfigPtr(BASS_CONFIG_NET_AGENT) - crashes, wrong use\n‚ùå Manual C string allocation with strdup - unnecessary complexity\n‚ùå HTTP header injection - BASS doesn't support it\n\nCONCLUSION:\nURL-embedded credentials is the correct, simple, standard approach that LMS expects and BASS supports natively.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T06:21:39.917202-05:00","updated_at":"2025-12-07T07:44:38.727309-05:00","closed_at":"2025-12-07T06:54:56.579794-05:00","dependencies":[{"issue_id":"LMS_StreamTest-afv","depends_on_id":"LMS_StreamTest-hmv","type":"blocks","created_at":"2025-12-07T06:22:02.393162-05:00","created_by":"daemon"},{"issue_id":"LMS_StreamTest-afv","depends_on_id":"LMS_StreamTest-48y","type":"blocks","created_at":"2025-12-07T06:29:06.032992-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-b7a","title":"Add TESTFLIGHT build flag to Xcode project settings","description":"## Issue\n\nTestFlight builds use **Release configuration**, not Debug. So `#if DEBUG` doesn't run in TestFlight builds.\n\nChanged code to `#if DEBUG || TESTFLIGHT` but need to add the TESTFLIGHT flag to build settings.\n\n## Steps to Add Flag in Xcode\n\n1. Open LMS_StreamTest.xcworkspace in Xcode\n2. Select the **project** (blue icon) in Project Navigator\n3. Select **LMS_StreamTest** target\n4. Click **Build Settings** tab\n5. Search for: **\"Other Swift Flags\"**\n6. Expand **\"Other Swift Flags\"** section\n7. Under **Release** configuration:\n   - Click the \"+\" button\n   - Add: `-D TESTFLIGHT`\n8. Under **Debug** configuration:\n   - Should already have `-D DEBUG` (leave as is)\n\n## Verify\n\nAfter adding the flag:\n- Debug builds: Both DEBUG and TESTFLIGHT flags active\n- Release builds (TestFlight): Only TESTFLIGHT flag active\n- App Store builds: Remove TESTFLIGHT flag before final submission\n\n## Testing\n\n1. Archive the app (Product ‚Üí Archive)\n2. Upload to TestFlight\n3. Install on device\n4. Check Settings ‚Üí Appearance\n5. Should show icon grid, NOT \"Unlock Icon Pack\" button\n\n## Files Modified\n\n- **LMS_StreamTestApp.swift**: Auto-unlock icon pack for TESTFLIGHT builds\n- **PurchaseManager.swift**: \n  - Extended debug helpers to work under TESTFLIGHT flag\n  - Preserve simulated purchases in updatePurchasedProducts() for TESTFLIGHT\n- **project.pbxproj**: Added `-D TESTFLIGHT` to Release configuration\n\n## For App Store Release\n\n**CRITICAL**: Before App Store submission, follow these steps to enable IAP:\n\n### 1. Remove TESTFLIGHT Flag\n1. Go to Build Settings ‚Üí Other Swift Flags ‚Üí Release\n2. Delete `-D TESTFLIGHT` entry\n3. This removes auto-unlock code from production builds\n\n### 2. Configure StoreKit in App Store Connect\n\n**Create In-App Purchase Product:**\n1. Log into App Store Connect\n2. Go to your app ‚Üí In-App Purchases\n3. Click \"+\" to create new product\n4. Select \"Non-Consumable\" type\n5. Configure:\n   - **Product ID**: `com.lyrplay.icons` (MUST match PurchaseManager.swift)\n   - **Reference Name**: \"LyrPlay Icon Pack\"\n   - **Price**: $2.99 USD (Tier 3)\n   - **Display Name**: \"Icon Pack\"\n   - **Description**: \"Unlock all 12 premium app icons including gradient, neon, retro, and vinyl designs\"\n\n**Upload Screenshots (required by Apple):**\n- Create 1-3 screenshots showing the icon selection UI\n- Recommended: Show icon grid from Settings ‚Üí Appearance\n- Size: Match your primary app screenshots (varies by device)\n\n**Localizations:**\n- Add at least one language (English recommended)\n- Can add more languages later\n\n### 3. StoreKit Testing (Optional but Recommended)\n\nBefore submitting, test IAP flow:\n1. In Xcode, go to Product ‚Üí Scheme ‚Üí Edit Scheme\n2. Run tab ‚Üí Options ‚Üí StoreKit Configuration\n3. Select \"Configuration.storekit\" (create if needed)\n4. Test purchase flow in simulator\n\n### 4. Archive Clean Build for App Store\n\n1. Remove TESTFLIGHT flag (step 1 above)\n2. Product ‚Üí Clean Build Folder\n3. Product ‚Üí Archive\n4. Upload to App Store Connect\n5. Submit for review\n\n### 5. BASS License (Before Monetization)\n\n**IMPORTANT**: Un4seen BASS library requires commercial license for paid apps:\n- **Cost**: ‚Ç¨125 (one-time, unlimited apps)\n- **Purchase**: https://www.un4seen.com/\n- **Requirement**: Must purchase before releasing paid app or accepting IAP\n- **Current Status**: Using free license (okay for TestFlight/testing)\n\n### 6. App Review Notes\n\nWhen submitting, add these notes for Apple reviewers:\n```\nThis app connects to Logitech Media Server (LMS) installations.\n\nTo test:\n1. App includes free default icon\n2. Icon Pack IAP unlocks 12 additional premium icons\n3. All core music playback features are free\n4. IAP is cosmetic only (alternate app icons)\n\nTest Account: Not required (IAP can be tested with Sandbox)\n```\n\n## Verification Checklist\n\nBefore App Store submission:\n- [ ] Removed `-D TESTFLIGHT` from Release build settings\n- [ ] Created IAP product in App Store Connect (com.lyrplay.icons)\n- [ ] Set price to $2.99 USD\n- [ ] Uploaded IAP screenshots\n- [ ] Tested IAP flow works (shows $2.99 unlock button)\n- [ ] Purchased BASS commercial license (‚Ç¨125)\n- [ ] Clean archive build without TESTFLIGHT flag\n- [ ] Added App Review notes about LMS requirement\n\n## Current Status (Build 10)\n\n‚úÖ TESTFLIGHT flag active in Release configuration\n‚úÖ Icons auto-unlock for TestFlight testers\n‚úÖ Code ready for App Store (just remove flag when ready)","notes":"## Issue\n\nTestFlight builds use **Release configuration**, not Debug. So `#if DEBUG` doesn't run in TestFlight builds.\n\nChanged code to `#if DEBUG || TESTFLIGHT` but need to add the TESTFLIGHT flag to build settings.\n\n## For App Store Release\n\n### 1. Remove TESTFLIGHT Flag\n1. Go to Build Settings ‚Üí Other Swift Flags ‚Üí Release\n2. Delete `-D TESTFLIGHT` entry\n3. This removes auto-unlock code from production builds\n\n### 2. App Store Connect IAP Setup ‚úÖ DONE\n- **Product ID**: `com.lyrplay.icons`\n- **Type**: Non-Consumable  \n- **Price**: $2.99 USD\n- Already configured in App Store Connect\n\n### 3. BASS License ‚úÖ CLEARED\nIan @ un4seen confirmed OK to release on App Store and see what purchases come in. No upfront license purchase required.\n\n### 4. Archive for App Store\n\n1. Remove TESTFLIGHT flag (step 1 above)\n2. Product ‚Üí Clean Build Folder\n3. Product ‚Üí Archive\n4. Upload to App Store Connect\n5. Submit for review\n\n## Checklist for App Store Submission\n\n- [ ] Remove `-D TESTFLIGHT` from Release build settings\n- [x] IAP product created in App Store Connect (com.lyrplay.icons)\n- [x] BASS license cleared with Ian @ un4seen\n- [ ] Clean archive build without TESTFLIGHT flag\n- [ ] Submit for review\n\n## Current Status (Build 17)\n\n‚úÖ TESTFLIGHT flag active in Release configuration\n‚úÖ Icons auto-unlock for TestFlight testers\n‚úÖ IAP configured in App Store Connect\n‚úÖ BASS license approved for App Store release\n‚úÖ Code ready - just remove TESTFLIGHT flag when ready to submit","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-13T09:50:57.981225-05:00","updated_at":"2025-12-17T22:43:55.675126-05:00","labels":["testflight","urgent"]}
{"id":"LMS_StreamTest-bmh","title":"OGG \u0026 Opus transcode not working - always outputs MP3","description":"User cannot get OGG or Opus transcoding to work. Lyrion plugin is installed correctly (Docker dev version on Synology), but:\n\n- OGG and Opus transcode settings always result in MP3 output\n- FLAC transcode works correctly\n- User's source files are Apple Lossless (ALAC)\n- Tried both Lyrion dev and stable versions\n\nNeed to verify:\n1. LyrPlay app properly accepts and requests OGG/Opus formats\n2. BASS library can handle OGG/Opus decoding/playback\n3. Lyrion server transcode configuration for OGG/Opus from ALAC sources\n\nThis may be a format negotiation issue between LyrPlay and Lyrion, or BASS codec support limitation.\n\nGitHub issue: #41\nAuthor: Seb0101\nOpened: Nov 5, 2025\n\nPriority: High - Core transcoding functionality not working for OGG/Opus formats","status":"in_progress","priority":1,"issue_type":"bug","created_at":"2025-11-30T14:58:37.449093-05:00","updated_at":"2025-12-01T06:51:21.823443-05:00","external_ref":"gh-41"}
{"id":"LMS_StreamTest-c4i","title":"Phase 7.6: Test Push Stream Synchronization End-to-End","description":"Verify push stream sync works with real LMS server. Test: 1) Create sync group with 2+ players, 2) Verify synchronized start (strm u with jiffies), 3) Test drift corrections (strm p/a), 4) Verify gapless playback still works, 5) Check sync group persistence. Collect logs showing jiffies timing and sync accuracy. Files: Console logs, LMS server logs","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-01T20:56:39.88363-05:00","updated_at":"2025-12-07T14:36:53.553828-05:00","closed_at":"2025-12-07T14:36:53.553828-05:00","dependencies":[{"issue_id":"LMS_StreamTest-c4i","depends_on_id":"LMS_StreamTest-512","type":"blocks","created_at":"2025-12-01T20:56:48.346825-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-ceb","title":"Phase 7.3: Implement Silence Injection for Push Streams","description":"Add timed pause (play silence) to StreamDecoder. For drift correction when player is ahead. Implementation: 1) Add playSilence(duration:) method, 2) Generate silence bytes (zeros) for duration, 3) Use BASS_StreamPutData to inject silence, 4) Continue with normal playback after silence. Files: StreamDecoder.swift","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-01T20:56:39.460396-05:00","updated_at":"2025-12-01T21:05:26.216546-05:00","closed_at":"2025-12-01T21:05:26.216546-05:00","dependencies":[{"issue_id":"LMS_StreamTest-ceb","depends_on_id":"LMS_StreamTest-db0","type":"blocks","created_at":"2025-12-01T20:56:48.234617-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-d7x","title":"Configure StoreKit settings for TestFlight and App Store releases","description":"## StoreKit Configuration File Usage Guide\n\n### Current Setup\n- Products.storekit file created for local IAP testing\n- Xcode scheme configured to use StoreKit Configuration (Edit Scheme ‚Üí Run ‚Üí Options)\n\n### How It Works in Different Environments\n\n#### 1. LOCAL DEBUGGING (Xcode builds to device/simulator)\n**StoreKit Configuration: ENABLED** ‚úÖ\n- Edit Scheme ‚Üí Run ‚Üí Options ‚Üí StoreKit Configuration: \"Products.storekit\"\n- Uses local Products.storekit file for testing\n- Purchases are FREE (testing mode)\n- Can reset transactions: Debug ‚Üí StoreKit ‚Üí Manage Transactions\n- NO App Store Connect configuration needed\n\n#### 2. TESTFLIGHT BUILDS\n**StoreKit Configuration: AUTOMATICALLY DISABLED** ‚úÖ\n- Xcode scheme settings ONLY apply to local debug builds\n- TestFlight builds ignore the StoreKit Configuration setting\n- Uses REAL App Store Connect IAP configuration\n- Testers see real product descriptions and pricing\n- Purchases are FREE for TestFlight testers (Sandbox mode)\n- REQUIREMENT: Must configure com.lyrplay.icons product in App Store Connect first\n\n#### 3. APP STORE PRODUCTION\n**StoreKit Configuration: AUTOMATICALLY DISABLED** ‚úÖ\n- Production builds NEVER use StoreKit Configuration file\n- Uses live App Store Connect IAP configuration\n- Purchases charge REAL MONEY ($2.99)\n- REQUIREMENT: Must configure com.lyrplay.icons product in App Store Connect\n\n### Action Items Before TestFlight\n\n**Option A: Keep Debug Auto-Unlock (Current)**\n- Leave LMS_StreamTestApp.swift debug code enabled\n- TestFlight testers get FREE unlocked icons (good for testing)\n- No App Store Connect IAP setup needed yet\n- Can gather feedback on which icons users like\n\n**Option B: Test Real Purchase Flow**\n1. Remove debug auto-unlock code from LMS_StreamTestApp.swift:\n   ```swift\n   #if DEBUG\n   // AUTO-UNLOCK ICON PACK FOR DEBUG BUILDS\n   // PurchaseManager.shared.simulatePurchase(.iconPack)  // ‚Üê Comment out\n   // os_log(.debug, log: logger, \"üß™ DEBUG: Icon Pack auto-unlocked for testing\")\n   #endif\n   ```\n\n2. Configure IAP in App Store Connect:\n   - Product ID: com.lyrplay.icons\n   - Type: Non-Consumable\n   - Price: $2.99 USD (Tier 3)\n   - Display Name: \"Premium Icon Pack\"\n   - Description: \"Customize your home screen with 11 premium icon designs...\"\n   - Family Sharing: Enabled\n   - Screenshot: (optional but recommended)\n\n3. TestFlight testers will see real purchase flow (but free in Sandbox)\n\n### Action Items Before App Store Release\n\n**CRITICAL - MUST DO FIRST:**\n1. ‚úÖ Purchase BASS Shareware license at https://www.un4seen.com/\n   - Cost: ‚Ç¨125 (‚âà$135 USD)\n   - Required because IAP = \"making money from the product\"\n   - Keep license email/certificate for records\n\n2. ‚úÖ Remove debug auto-unlock code (if not already done)\n\n3. ‚úÖ Configure IAP in App Store Connect (if not already done)\n\n4. ‚úÖ NO Xcode scheme changes needed - production ignores StoreKit Configuration\n\n### Summary\n\n**YOU DON'T NEED TO CHANGE ANYTHING IN XCODE SCHEMES!**\n\nThe StoreKit Configuration file setting:\n- ‚úÖ Only affects LOCAL debug builds (your Mac)\n- ‚ùå Does NOT affect TestFlight builds\n- ‚ùå Does NOT affect App Store builds\n\nKeep the setting as-is. TestFlight and App Store automatically use real App Store Connect configuration.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T07:42:59.594233-05:00","updated_at":"2025-12-13T07:42:59.594233-05:00"}
{"id":"LMS_StreamTest-d98","title":"Fix reconnection position jumps - backward jumps and track skips on reconnect","description":"When LyrPlay loses server connection while playing from buffer and reconnects minutes later:\n1. Position jumps backward to disconnect time (user at 3:30, jumps to 1:30) \n2. Track skips forward to next track unexpectedly\n\nRoot cause: Server saves positionAtDisconnect when connection lost, client continues playing from buffer, but on reconnect server's playerReconnect() uses stale position causing backward jump.\n\nSolution: Block server's auto-resume and take full control of position restoration by:\n- Track playback state at disconnect moment with wasPlayingAtDisconnect flag\n- On reconnect, immediately send STOP to block server's auto-resume  \n- Query current position from AudioManager\n- Send playlist jump with current position (overrides server's stale position)\n- Resume playback\n\nImplementation requires 3 small changes to SlimProtoCoordinator.swift:\n1. Add wasPlayingAtDisconnect flag (~line 35)\n2. Capture state in slimProtoDidDisconnect() (~line 527) \n3. Override position in slimProtoDidConnect() (~line 514)\n\nLeverages existing infrastructure (AudioManager APIs, JSON-RPC commands, UserDefaults) with minimal code addition (~45 lines). Compatible with existing lock screen recovery - different triggers prevent conflicts.\n\nTesting scenarios: long disconnect while playing, paused during disconnect, quick reconnect, app backgrounded scenarios.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-11-30T22:05:59.439757-05:00","updated_at":"2025-11-30T22:06:06.94233-05:00"}
{"id":"LMS_StreamTest-db0","title":"Phase 7.2: Implement Delayed Start for Push Streams","description":"Add synchronized start capability to StreamDecoder. Similar to AudioPlayer.startAt() but for push streams. Implementation: 1) Add startAtJiffies() method to StreamDecoder, 2) Buffer data but don't call BASS_ChannelPlay until target time, 3) Monitor jiffies with timer (100ms), 4) Start playback when time reached. Files: StreamDecoder.swift","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-01T20:56:39.315951-05:00","updated_at":"2025-12-01T21:03:53.874247-05:00","closed_at":"2025-12-01T21:03:53.874247-05:00","dependencies":[{"issue_id":"LMS_StreamTest-db0","depends_on_id":"LMS_StreamTest-1us","type":"blocks","created_at":"2025-12-01T20:56:48.199417-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-ea3","title":"Add authentication support for password-protected LMS servers","description":"Implement HTTP Basic Authentication for password-protected LMS servers.\n\nCRITICAL DISCOVERY - URL-EMBEDDED CREDENTIALS:\n‚úÖ LMS uses standard HTTP URL-embedded credentials for stream authentication\n‚úÖ Format: http://username:password@server:port/stream.mp3\n‚úÖ Documented in LMS remote streaming documentation\n‚úÖ BASS supports this automatically - no special configuration needed\n\nIMPLEMENTATION COMPLETE:\n‚úÖ Phase 1: KeychainManager - secure iOS Keychain credential storage\n‚úÖ Phase 1A: Research - confirmed URL-embedded credentials approach\n‚úÖ Phase 2: SettingsManager - auth properties with Keychain integration\n‚úÖ Phase 3: Auth header generation - generateAuthHeader() for WebView\n‚úÖ Phase 4: URL credential injection - injectCredentialsIntoURL() for streams\n‚úÖ Phase 5: Settings UI - username/password fields in server config views\n‚úÖ Phase 5A: WebView lockout prevention - 401 detection with fallback settings button\n\nREMAINING TASKS:\n- Phase 6: Handle 401 Unauthorized responses gracefully (may not be needed - URL auth handles this)\n- Phase 7: Test authentication with authenticated and non-authenticated servers\n- Onboarding: Add optional authentication fields to first-time setup\n\nIMPORTANT NOTES:\n- BASS_CONFIG_NET_AGENT does NOT work for Authorization headers (User-Agent only)\n- WebView authentication: Browser handles HTTP Basic Auth prompt automatically\n- Stream authentication: URLComponents.user/.password injects credentials\n- No manual HTTP header management needed - standard protocols work\n\nFILES MODIFIED:\n- KeychainManager.swift (NEW) - secure credential storage\n- SettingsManager.swift - auth properties, Keychain integration, URL injection\n- SettingsView.swift - ServerConfigView and BackupServerConfigView UI fields\n- SlimProtoCommandHandler.swift - URL credential injection before stream creation\n- ContentView.swift - WebView 401 detection and error handling\n- AudioPlayer.swift - BASS auth code disabled (not needed with URL credentials)\n\nREFERENCE CODE:\n- slimserver/HTML/EN/html/docs/remotestreaming.html (URL auth documentation)\n- slimserver/Slim/Web/HTTP.pm (checkAuthorization - validates both WebView and streams)\n- No changes needed to squeezelite reference - URL credentials are standard HTTP","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T21:39:44.340738-05:00","updated_at":"2025-12-07T12:34:58.214888-05:00","closed_at":"2025-12-07T12:34:58.214888-05:00","dependencies":[{"issue_id":"LMS_StreamTest-ea3","depends_on_id":"LMS_StreamTest-7oi","type":"blocks","created_at":"2025-12-07T06:21:33.460613-05:00","created_by":"daemon"},{"issue_id":"LMS_StreamTest-ea3","depends_on_id":"LMS_StreamTest-8fs","type":"blocks","created_at":"2025-12-07T06:22:02.044817-05:00","created_by":"daemon"},{"issue_id":"LMS_StreamTest-ea3","depends_on_id":"LMS_StreamTest-hmv","type":"blocks","created_at":"2025-12-07T06:22:02.192521-05:00","created_by":"daemon"},{"issue_id":"LMS_StreamTest-ea3","depends_on_id":"LMS_StreamTest-afv","type":"blocks","created_at":"2025-12-07T06:22:02.327604-05:00","created_by":"daemon"},{"issue_id":"LMS_StreamTest-ea3","depends_on_id":"LMS_StreamTest-hqs","type":"blocks","created_at":"2025-12-07T06:22:02.457348-05:00","created_by":"daemon"},{"issue_id":"LMS_StreamTest-ea3","depends_on_id":"LMS_StreamTest-60n","type":"blocks","created_at":"2025-12-07T06:22:02.586832-05:00","created_by":"daemon"},{"issue_id":"LMS_StreamTest-ea3","depends_on_id":"LMS_StreamTest-q4e","type":"blocks","created_at":"2025-12-07T06:22:02.71665-05:00","created_by":"daemon"},{"issue_id":"LMS_StreamTest-ea3","depends_on_id":"LMS_StreamTest-48y","type":"blocks","created_at":"2025-12-07T06:29:05.791193-05:00","created_by":"daemon"},{"issue_id":"LMS_StreamTest-ea3","depends_on_id":"LMS_StreamTest-387","type":"blocks","created_at":"2025-12-07T06:29:05.913802-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-ea3.1","title":"Add optional authentication to onboarding flow","description":"Add optional authentication fields to the onboarding ServerSetupView.\n\nImplementation:\n- Add collapsible DisclosureGroup with \"Advanced (Optional)\" label\n- Include username TextField and password SecureField\n- Add help text: \"Leave blank if server doesn't require authentication\"\n- Connect fields to SettingsManager properties (serverUsername, serverPassword)\n- Ensure credentials are saved to Keychain when user completes setup\n\nLocation: OnboardingViews.swift - ServerSetupView (around line 250)\n\nThis allows users with password-protected LMS servers to configure credentials during first-time setup, while keeping the UI clean for users without authentication requirements.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T06:52:04.03262-05:00","updated_at":"2025-12-07T13:19:33.411353-05:00","closed_at":"2025-12-07T13:19:33.411353-05:00","dependencies":[{"issue_id":"LMS_StreamTest-ea3.1","depends_on_id":"LMS_StreamTest-ea3","type":"parent-child","created_at":"2025-12-07T06:52:04.033107-05:00","created_by":"daemon"},{"issue_id":"LMS_StreamTest-ea3.1","depends_on_id":"LMS_StreamTest-k14","type":"blocks","created_at":"2025-12-07T12:36:22.852326-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-eiz","title":"Synchronization with other players failing","description":"# Player Synchronization Implementation\n\n## RESEARCH COMPLETE - How SlimProto Sync Works\n\n### Core Concept: Jiffies-Based Time Synchronization\nPlayers synchronize by agreeing on a common time base (\"jiffies epoch\") and starting playback at precise future timestamps.\n\n---\n\n## 1. Jiffies Epoch Tracking (Server ‚Üî Player Time Agreement)\n\n**What are jiffies?**\n- Player's local millisecond timer (gettime_ms())\n- Sent in every STAT packet to server\n- Server uses this to calculate player's time base\n\n**Jiffies Epoch Calculation** (Player.pm:932):\n```\njiffiesTime = jiffies / ticspersec\noffset = serverTimestamp - jiffiesTime\nepoch = offset (adjusted for drift)\n```\n\n**LyrPlay Implementation:**\n- Track jiffiesEpoch in SlimProtoCoordinator\n- Update epoch on every STAT received (like trackJiffiesEpoch)\n- Use offset list to handle clock drift correction\n- Current jiffies = gettime_ms()\n\n---\n\n## 2. Sync Group Formation\n\n**HELO Packet** - Advertise sync capability:\n```\ncapabilities += \",SyncgroupID=\u003csyncgroup_id\u003e\"\n```\n\n**serv Packet** - Server assigns sync group:\n- Contains 10-byte sync group ID\n- Store in SlimProtoCoordinator\n- Send in subsequent HELO reconnects\n\n**LyrPlay Status:** ‚úÖ HELO sync capability already implemented\n\n---\n\n## 3. Synchronized Start (strm 'u' - Unpause)\n\n**Server Side** (Squeezebox2.pm:1098):\n```perl\n$client-\u003estream('u', { \n  'interval' =\u003e int(($startTime - $client-\u003ejiffiesEpoch()) * 1000) \n});\n```\n\n**Protocol** (Squeezebox.pm:1078):\n- strm command = 'u'\n- replay_gain field = jiffies timestamp (when to start)\n\n**Player Side** (output.c:99-109):\n```c\nif (output.state == OUTPUT_START_AT) {\n    u32_t now = gettime_ms();\n    if (now \u003e= output.start_at || output.start_at \u003e now + 10000) {\n        output.state = OUTPUT_RUNNING;\n    } else {\n        // Play silence until start_at time reached\n        u32_t delta_frames = (output.start_at - now) * sample_rate / 1000;\n        play_silence(delta_frames);\n    }\n}\n```\n\n**LyrPlay Implementation:**\n1. Parse strm 'u' command\n2. Extract jiffies from replay_gain field (network byte order)\n3. If jiffies == 0: start immediately (OUTPUT_RUNNING)\n4. If jiffies \u003e 0: enter OUTPUT_START_AT state\n5. **Play silence** until gettime_ms() \u003e= start_at\n6. Then switch to OUTPUT_RUNNING and play audio\n7. Send STMr (resume acknowledgment)\n\n---\n\n## 4. Sync Corrections (Drift Handling)\n\n**strm 'p' - Timed Pause** (Squeezebox2.pm:1114):\n```perl\n$client-\u003estream('p', { 'interval' =\u003e $milliseconds });\n```\n- Play silence for N milliseconds to slow down\n- Then resume playback\n- Corrects \"player ahead\" drift\n\n**strm 'a' - Skip Ahead** (Squeezebox2.pm:1122):\n```perl\n$client-\u003estream('a', { 'interval' =\u003e $milliseconds });\n```\n- Skip N milliseconds of audio (consume buffer without playing)\n- Corrects \"player behind\" drift\n\n**LyrPlay Implementation:**\n- strm 'p': Set pauseFramesRemaining, play silence\n- strm 'a': Skip frames in BASS buffer using BASS_ChannelSetPosition\n\n---\n\n## 5. STAT Packet Requirements\n\n**Critical Fields** (slimproto.c:186):\n```c\npackN(\u0026pkt.jiffies, now);  // Current player time (gettime_ms())\npackN(\u0026pkt.elapsed_milliseconds, ms_played);\npkt.server_timestamp = server_timestamp;  // Echo from strm 't'\n```\n\n**LyrPlay Status:** ‚úÖ Already sending jiffies in STAT packets\n\n---\n\n## Implementation Plan for LyrPlay\n\n### Phase 1: Jiffies Epoch Tracking ‚¨ú\n```swift\n// SlimProtoCoordinator\nprivate var jiffiesEpoch: TimeInterval = 0\nprivate var jiffiesOffsetList: [TimeInterval] = []\n\nfunc trackJiffiesEpoch(jiffies: UInt32, serverTimestamp: TimeInterval) {\n    let jiffiesTime = Double(jiffies) / 1000.0\n    let offset = serverTimestamp - jiffiesTime\n    \n    // Adjust epoch if better estimate or wrap-around\n    if offset \u003c jiffiesEpoch || offset - jiffiesEpoch \u003e 50 {\n        jiffiesEpoch = offset\n    }\n    \n    // Track drift for corrections\n    jiffiesOffsetList.insert(offset - jiffiesEpoch, at: 0)\n    if jiffiesOffsetList.count \u003e 8 { jiffiesOffsetList.removeLast() }\n}\n```\n\n### Phase 2: strm 'u' Unpause with Timing ‚¨ú\n```swift\n// SlimProtoCommandHandler\ncase let strmData where strmData[0] == UInt8(ascii: \"u\"):\n    let replayGainBytes = strmData[12..\u003c16]\n    let jiffies = replayGainBytes.withUnsafeBytes { \n        $0.load(as: UInt32.self).bigEndian \n    }\n    \n    if jiffies == 0 {\n        audioPlayer?.resume()  // Start immediately\n    } else {\n        let startAt = TimeInterval(jiffies)\n        audioPlayer?.startAt(jiffies: startAt)  // New method\n    }\n    \n    sendSTAT(event: \"STMr\")\n```\n\n### Phase 3: OUTPUT_START_AT State ‚¨ú\n```swift\n// AudioPlayer\nenum PlaybackState {\n    case stopped, buffering, running, startAt(jiffies: TimeInterval)\n}\n\nfunc startAt(jiffies: TimeInterval) {\n    self.playbackState = .startAt(jiffies: jiffies)\n    \n    // In audio callback/timer:\n    if case .startAt(let targetJiffies) = playbackState {\n        let now = gettime_ms()\n        if now \u003e= targetJiffies {\n            playbackState = .running\n            BASS_ChannelPlay(currentStream, 0)\n        } else {\n            // Keep buffering, don't play yet\n            // or output silence if needed\n        }\n    }\n}\n```\n\n### Phase 4: Sync Corrections ‚¨ú\n```swift\n// strm 'p' - timed pause\ncase let strmData where strmData[0] == UInt8(ascii: \"p\"):\n    let intervalMs = // extract from replay_gain field\n    audioPlayer?.pauseForInterval(milliseconds: intervalMs)\n\n// strm 'a' - skip ahead  \ncase let strmData where strmData[0] == UInt8(ascii: \"a\"):\n    let intervalMs = // extract from replay_gain field\n    audioPlayer?.skipAhead(milliseconds: intervalMs)\n```\n\n### Phase 5: Sync Group Persistence ‚¨ú\n- Store syncGroupID in UserDefaults\n- Include in HELO on reconnect\n- Parse from serv packet (10-byte field)\n\n---\n\n## Testing Strategy\n\n1. **Epoch tracking**: Log jiffies drift over time, verify convergence\n2. **Basic sync**: Pair with squeezelite, verify synchronized start\n3. **Drift correction**: Run 30+ minutes, verify strm 'p'/'a' commands handled\n4. **Reconnection**: Verify sync group persists across app restarts\n5. **Multi-room**: Test with 3+ players in sync group\n\n---\n\n## Files to Modify\n\n1. **SlimProtoCoordinator.swift**\n   - Add jiffiesEpoch tracking\n   - Parse strm 'u' with timing\n   - Handle sync group from serv packet\n\n2. **SlimProtoCommandHandler.swift**\n   - Route strm 'p' and strm 'a' commands\n   - Extract timing from replay_gain field\n\n3. **AudioPlayer.swift**\n   - Implement OUTPUT_START_AT state\n   - Add startAt(jiffies:) method\n   - Implement pauseForInterval() and skipAhead()\n\n4. **SettingsManager.swift**\n   - Store syncGroupID persistence\n\n---\n\n## Key References\n\n- squeezelite/output.c:99-109 (OUTPUT_START_AT implementation)\n- slimserver/Slim/Player/Squeezebox2.pm:1093-1124 (sync commands)\n- slimserver/Slim/Player/Player.pm:932-996 (jiffies epoch tracking)\n- squeezelite/slimproto.c:332-342 (strm 'u' handling)\n\nPriority: P1 - Core multi-room functionality\nStatus: Ready to implement with research complete","notes":"## ‚úÖ PLAYER SYNC WORKING!\n\n### Fixes Applied This Session:\n\n**1. STMl Buffer Check Fix** (commit fa2235d)\n- Wrong variable checked: playbackBuffered (BASS internal ~KB) vs totalBytesPushed (actual data ~MB)\n- Fixed in AudioStreamDecoder.swift line 992\n\n**2. Deferred Track Playback Fix** (commit c58947b)\n- Fixed format mismatch transitions (e.g., local‚ÜíQobuz FLAC)\n- Clear stale isWaitingForSyncStart flag in startDeferredTrack()\n- Set sentSTMl=true to prevent invalid STMl after track starts\n\n**3. Jiffies Epoch Fix** (pending commit)\n- SlimProtoClient.swift line 406: STAT packet was sending Unix epoch time (~1.7B seconds) instead of system uptime (~1.4M seconds)\n- Fixed: ProcessInfo.processInfo.systemUptime * 1000 (matches squeezelite gettime_ms())\n\n**4. Sync Start Timer Thread Fix** (pending commit)  \n- AudioStreamDecoder.startSyncStartMonitoring() timer was scheduled on socket background thread\n- Timer never fired because no active run loop\n- Fixed by wrapping in DispatchQueue.main.async {}\n\n### Known Issue\n- Seeking while synced has minor issues (deferred to future fix)\n\n### Test Results\n- ‚úÖ Both players pause together\n- ‚úÖ Both players unpause together (synchronized start works!)\n- ‚ö†Ô∏è Seeking during sync has minor issues","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-30T15:01:29.089852-05:00","updated_at":"2025-12-07T14:37:04.073187-05:00","closed_at":"2025-12-07T14:37:04.073187-05:00","external_ref":"gh-36","dependencies":[{"issue_id":"LMS_StreamTest-eiz","depends_on_id":"LMS_StreamTest-5uz","type":"parent-child","created_at":"2025-12-01T20:33:02.642248-05:00","created_by":"daemon"},{"issue_id":"LMS_StreamTest-eiz","depends_on_id":"LMS_StreamTest-244","type":"parent-child","created_at":"2025-12-01T20:33:02.683641-05:00","created_by":"daemon"},{"issue_id":"LMS_StreamTest-eiz","depends_on_id":"LMS_StreamTest-owe","type":"parent-child","created_at":"2025-12-01T20:33:02.721711-05:00","created_by":"daemon"},{"issue_id":"LMS_StreamTest-eiz","depends_on_id":"LMS_StreamTest-87x","type":"parent-child","created_at":"2025-12-01T20:33:02.755931-05:00","created_by":"daemon"},{"issue_id":"LMS_StreamTest-eiz","depends_on_id":"LMS_StreamTest-139","type":"parent-child","created_at":"2025-12-01T20:33:02.79212-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-fpz","title":"MP3 transcode defaults to 128kbps - investigate server bitrate configuration","description":"## Issue\n\nMP3 transcoding always defaults to 128kbps regardless of source quality. This results in unnecessary quality loss for mobile/transcode scenarios.\n\n## Expected Behavior\n\n- High-quality sources (FLAC, WAV) should transcode to higher bitrate MP3 (320kbps or at least 256kbps)\n- Lower quality sources can use 128kbps or appropriate bitrate\n- User should have control over transcode quality preference\n\n## Current Behavior\n\nAll MP3 transcodes use 128kbps, even when transcoding lossless FLAC files.\n\n## Investigation Areas\n\n### 1. Server-Side Configuration\n\nCheck LMS server's `custom-convert.conf` file for MP3 transcode rules:\n- Default bitrate settings\n- Quality flags for lame/ffmpeg encoder\n- Mobile-specific transcode rules\n\n### 2. MobileTranscode Settings\n\nThe app uses `mobiletranscode` preference. Possible issues:\n- Server default bitrate for mobile transcoding\n- Missing quality parameter in transcode requests\n- LMS plugin configuration for mobile devices\n\n### 3. SlimProto Protocol\n\nReview protocol messages:\n- Does SlimProto support requesting specific bitrate?\n- Are we sending quality preferences to server?\n- Check STRM command parameters\n\n## Likely Solution\n\nUpdate `custom-convert.conf` on LMS server with higher quality MP3 settings for mobile transcode:\n\n```bash\n# Find current MP3 transcode rules\ngrep -A 5 \"mp3\" /path/to/custom-convert.conf\n\n# Typical location: /etc/squeezeboxserver/custom-convert.conf\n# Or: ~/Library/Application Support/Squeezebox/custom-convert.conf (macOS)\n```\n\nExpected fix: Change lame encoder quality flags from `-b 128` to `-b 320` or add VBR settings.\n\n## Files to Review\n\n- **LMS Server**: `custom-convert.conf` (server-side)\n- **SlimProtoCoordinator.swift**: Check mobiletranscode preference handling\n- **SettingsManager.swift**: Verify transcode settings sent to server\n- **slimserver source code**: Reference for transcode protocol details\n\n## Testing Plan\n\n1. Check current `custom-convert.conf` MP3 settings\n2. Modify bitrate to 320kbps\n3. Test FLAC ‚Üí MP3 transcode quality\n4. Verify bitrate in stream metadata\n5. Document recommended server configuration\n\n## Priority\n\nP2 - Quality improvement, not blocking. Users can disable transcode for WiFi to get full quality.\n\n## Related\n\n- Mobile transcode feature (currently working, just low quality)\n- Server-side configuration documentation needed","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T15:27:26.032612-05:00","updated_at":"2025-12-13T15:27:26.032612-05:00"}
{"id":"LMS_StreamTest-g16","title":"Change default audio format from .compressed to .flac for fresh installs","description":"## Current Code\n\n**SettingsManager.swift:206**\n```swift\nlet audioFormatRaw = UserDefaults.standard.integer(forKey: Keys.audioFormat)\naudioFormat = AudioFormat(rawValue: audioFormatRaw) ?? .compressed\n```\n\n**Current default**: `.compressed` (MP3 preferred)\n**Desired default**: `.flac` (Lossless FLAC)\n\n## AudioFormat Enum Values\n\n```swift\nenum AudioFormat: Int {\n    case compressed = 0    // ‚Üê Current default\n    case aacPreferred = 1\n    case oggVorbis = 2\n    case flac = 3          // ‚Üê Desired default\n    case opus = 4\n    case custom = 5\n}\n```\n\n## Problem\n\nFresh installs default to `.compressed` which prioritizes MP3/AAC over FLAC:\n- **compressed**: `\"mp3,aac\"` capability codes\n- **flac**: `\"flc,ops,ogg,alc,aac,mp3\"` capability codes\n\nUsers with high-quality FLAC libraries get MP3 transcodes by default.\n\n## Solution\n\nChange line 206 from:\n```swift\naudioFormat = AudioFormat(rawValue: audioFormatRaw) ?? .compressed\n```\n\nTo:\n```swift\naudioFormat = AudioFormat(rawValue: audioFormatRaw) ?? .flac\n```\n\n## Migration Impact\n\n**Fresh installs**: Get FLAC-first format priority ‚úÖ\n**Existing users**: Keep their saved audioFormat setting ‚úÖ\n\nUserDefaults will have `audioFormat` key already set, so fallback never triggers for existing users.\n\n## Files to Modify\n\n- **SettingsManager.swift**: Line 206 only\n\n## Testing\n\n1. **Fresh install**: Delete app, install, verify Settings shows \"Lossless (FLAC)\" by default\n2. **Existing user**: Upgrade from old build, verify format setting preserved\n3. **Capability string**: Verify HELO message includes `flc,ops,ogg,alc,aac,mp3`\n\n## Rationale\n\nLyrPlay positions as premium/high-quality audio app. Users expect best quality out of box. Mobile transcode toggle already exists for data optimization.\n\n## Priority\n\nP1 - Better first impression, matches app positioning","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T15:30:49.468395-05:00","updated_at":"2025-12-14T19:43:55.528535-05:00","closed_at":"2025-12-14T19:43:55.528535-05:00"}
{"id":"LMS_StreamTest-hmv","title":"Phase 3: Add HTTP Basic Auth header generation utility","description":"Create utility method to generate HTTP Basic Authorization headers from username/password credentials.\n\nImplementation Details:\n- Add static func in SettingsManager\n- Implement base64 encoding of 'username:password'\n- Generate 'Authorization: Basic \u003cbase64\u003e' header string\n- Handle empty/nil credentials gracefully\n- Add unit tests for header generation\n\nExample:\nstatic func generateAuthHeader(username: String, password: String) -\u003e String? {\n    guard !username.isEmpty else { return nil }\n    let credentials = \"\\(username):\\(password)\"\n    let base64 = Data(credentials.utf8).base64EncodedString()\n    return \"Authorization: Basic \\(base64)\"\n}\n\nFiles to Modify:\n- LMS_StreamTest/SettingsManager.swift","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T06:21:37.992375-05:00","updated_at":"2025-12-07T06:44:08.017367-05:00","closed_at":"2025-12-07T06:44:08.017367-05:00","dependencies":[{"issue_id":"LMS_StreamTest-hmv","depends_on_id":"LMS_StreamTest-7oi","type":"blocks","created_at":"2025-12-07T06:22:02.261279-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-hqs","title":"Phase 5: Add username and password fields to Settings UI","description":"Add username/password input fields to server configuration views with secure text entry.\n\nImplementation Details:\n- Update ServerConfigView with username/password TextFields\n- Use .textContentType(.username) and .textContentType(.password)\n- Add SecureField for password entry (masked input)\n- Update BackupServerConfigView with same credential fields\n- Add 'Clear Credentials' button option\n- Show authentication status indicator\n- Validate credentials before saving\n- Add helpful text explaining when auth is needed\n\nUI Layout Example:\nServer Address: [text field]\nUsername: [text field] (optional)\nPassword: [secure field] (optional)\n[Save] [Test Connection]\n\nFiles to Modify:\n- LMS_StreamTest/SettingsView.swift (ServerConfigView)\n- LMS_StreamTest/SettingsView.swift (BackupServerConfigView)\n\nDependencies:\n- Requires SettingsManager auth properties (Phase 2)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T06:21:42.043719-05:00","updated_at":"2025-12-07T06:57:01.651058-05:00","closed_at":"2025-12-07T06:57:01.651058-05:00","dependencies":[{"issue_id":"LMS_StreamTest-hqs","depends_on_id":"LMS_StreamTest-8fs","type":"blocks","created_at":"2025-12-07T06:22:02.522912-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-jdj","title":"Test: Manual server switch still reconnects properly","description":"Verify that clicking the Switch button in Settings ‚Üí Server Settings properly switches between Primary and Backup servers with successful reconnection. Should see 'üîÑ Active server changed' log followed by reconnection to new server.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T19:36:31.776709-05:00","updated_at":"2025-12-08T19:44:53.677227-05:00","closed_at":"2025-12-08T19:44:53.677227-05:00","dependencies":[{"issue_id":"LMS_StreamTest-jdj","depends_on_id":"LMS_StreamTest-9pe","type":"blocks","created_at":"2025-12-08T19:36:55.422395-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-jr2","title":"commit current work to new branch","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T14:44:33.672652-05:00","updated_at":"2025-11-30T14:49:57.59035-05:00","closed_at":"2025-11-30T14:49:57.59035-05:00"}
{"id":"LMS_StreamTest-k14","title":"Phase 8: Clean up auth implementation - remove debug logging and unused code","description":"Clean up authentication implementation by removing temporary debug logging and unused/commented code.\n\nItems to clean up:\n1. AudioPlayer.swift - Remove commented-out BASS auth code (lines 202-233)\n2. Review all auth-related logging statements - reduce verbosity for production\n3. Remove any temporary debug code added during implementation\n4. Verify no sensitive data (passwords) in any logs\n\nFiles to review:\n- AudioPlayer.swift (commented BASS auth code)\n- SettingsManager.swift (auth logging)\n- ContentView.swift (WebView auth logging)\n- SlimProtoCoordinator.swift (JSON-RPC auth logging)\n- SlimProtoCommandHandler.swift (URL injection logging)\n\nSuccess criteria:\n- No commented-out code blocks\n- Production-appropriate logging levels\n- No password leakage in logs (already masked, but verify)\n- Code is clean and maintainable","notes":"Authentication Cleanup Task - Detailed Items\n\n## 1. Remove Commented BASS Auth Code\n**File**: AudioPlayer.swift\n**Lines**: 202-233\n**Description**: Entire MARK section for \"HTTP Basic Authentication\"\n**Reason**: BASS auth approach abandoned in favor of URL-embedded credentials\n**Action**: Delete entire block including:\n- Header generation code\n- strdup allocation\n- Commented BASS_SetConfigPtr calls\n- \"BASS auth DISABLED\" logging\n\n## 2. Review Auth Logging Verbosity\n\n### Keep (Important for debugging):\n- ContentView.swift:698 - 401 error page detection (ERROR level)\n- ContentView.swift:817 - HTTP 401 Unauthorized (ERROR level)\n\n### Consider Removing (Debug only):\n- SettingsManager.swift:674 - \"üîê Injected credentials\" (INFO level)\n  * Shows on every stream URL - could be verbose in production\n  * Recommendation: Change to .debug level or remove\n\n- ContentView.swift:591 - \"üîê Added Authorization header for WebView\" (INFO level)\n  * Shows on every WebView load\n  * Recommendation: Change to .debug level\n\n- SlimProtoCoordinator.swift:1276 - \"üîê Added auth to JSON-RPC\" (DEBUG level - OK)\n- SlimProtoCoordinator.swift:1628 - \"üîê Added auth to JSON-RPC\" (DEBUG level - OK)\n\n## 3. Verify No Password Leakage\n\n### Already Masked (Good):\n- SettingsManager.swift:674 - Logs username only, not password\n- ContentView.swift:591 - Logs username only\n- SlimProtoCoordinator.swift - Logs username only\n\n### URLs in Logs:\n- Check if any URL logging shows full credentials\n- injectCredentialsIntoURL should mask password in returned URLs for logging\n\n## 4. Remove Temporary Comments\n\nSearch for comments containing:\n- \"TEMPORARILY DISABLED\"\n- \"investigating\"\n- \"TODO\" related to auth\n- Any placeholder comments from implementation\n\n## 5. Code Quality Check\n\n- Remove any unused variables (authHeaderPointer if BASS block removed)\n- Clean up imports (if any were added for unused code)\n- Verify all functions are still used after cleanup\n\n## Recommendations Summary\n\n**REMOVE**:\n1. AudioPlayer.swift:202-233 - Entire commented BASS auth block\n2. AudioPlayer.swift - authHeaderPointer property if it exists\n\n**REDUCE LOGGING**:\n1. SettingsManager.swift:674 - Change to .debug level\n2. ContentView.swift:591 - Change to .debug level\n\n**KEEP**:\n1. All error-level 401 detection logging\n2. Debug-level JSON-RPC auth logging\n3. All security checks and masking\n\n**VERIFY**:\n1. No passwords in any log output\n2. URL logging masks credentials properly\n3. No unused imports or variables after cleanup","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T12:36:17.636038-05:00","updated_at":"2025-12-07T12:46:39.733724-05:00","closed_at":"2025-12-07T12:46:39.733724-05:00"}
{"id":"LMS_StreamTest-mx0","title":"White text on light grey background - poor readability","description":"Cosmetic UI issue with poor text contrast. White text on light grey background is difficult to read.\n\nUser suggests changing text color to blue for better visibility.\n\nThis appears to be a SwiftUI color scheme issue where text colors don't adapt properly to certain background elements, causing accessibility and usability problems.\n\nGitHub issue: #47\nAuthor: ChristianNoc  \nOpened: Nov 22, 2025\n\nPriority: Low - Cosmetic issue but affects user experience and accessibility\n\nFiles likely affected: SwiftUI views with text styling, color scheme definitions","status":"closed","priority":3,"issue_type":"bug","created_at":"2025-11-30T14:57:08.992482-05:00","updated_at":"2025-11-30T19:25:14.935952-05:00","closed_at":"2025-11-30T19:25:14.935952-05:00","external_ref":"gh-47"}
{"id":"LMS_StreamTest-o5u","title":"CarPlay connection failure - no retry mechanism when server unreachable","description":"## Problem\n\nWhen entering car and launching LyrPlay via CarPlay:\n1. Press LyrPlay button in CarPlay\n2. See \"Loading\" async spinner for cover art/albums/playlists\n3. Loading never completes - spinner stays forever\n4. Press resume playback - nothing happens\n5. Open app on iOS device - \"Cannot connect to server\" popup appears\n\n**Root Cause**: CarPlay UI tried to connect but server was unreachable. No retry mechanism or error handling when initial connection fails.\n\n## Expected Behavior\n\nWhen CarPlay connection fails:\n1. Show error state in CarPlay UI (not infinite loading)\n2. Provide \"Retry Connection\" button/option\n3. Or auto-retry with exponential backoff\n4. Display helpful error message (\"Server unreachable - check network\")\n\n## Current Behavior\n\n- Infinite loading spinner in CarPlay\n- No error feedback to user\n- No way to retry from CarPlay\n- Must open phone app to see actual error\n\n## Impact\n\n- User gets stuck in car with non-functional CarPlay UI\n- Must physically interact with phone (unsafe while driving)\n- Poor UX - looks like app is broken, not network issue\n\n## Proposed Solution\n\n### Option 1: Retry Button\n- Detect connection failure in CarPlaySceneDelegate\n- Show error template with \"Retry\" button\n- Allow user to manually retry connection\n\n### Option 2: Auto-Retry with Timeout\n- Auto-retry 3 times with 2s, 4s, 8s delays\n- Show error after all retries fail\n- Provide \"Retry Now\" button\n\n### Option 3: Background Connection Monitor\n- Start background connection attempt when CarPlay connects\n- Show placeholder UI while connecting\n- Auto-refresh UI when connection succeeds\n- Show error state if connection times out\n\n## Files Likely Involved\n\n- **CarPlaySceneDelegate.swift**: CarPlay lifecycle and template management\n- **SlimProtoCoordinator.swift**: Connection management and error handling\n- **SettingsManager.swift**: Server configuration and connection state\n\n## Testing Checklist\n\n- [ ] Connect CarPlay with LMS server offline\n- [ ] Verify error state shows (not infinite spinner)\n- [ ] Test retry mechanism works\n- [ ] Verify auto-recovery when server comes online\n- [ ] Test with VPN disconnected (common car scenario)\n- [ ] Verify main app shows same connection state\n\n## Related Issues\n\nThis affects CarPlay Browse interface (Phase 2) - connection reliability is critical for safety.","notes":"## Implementation Complete - PENDING TESTING\n\nFixed CarPlay connection failure infinite loading spinner issue with comprehensive error handling and retry mechanism.\n\n### Changes Made (CarPlaySceneDelegate.swift)\n\n**1. Connection State Check (Line 53-65)**\n- Added 1-second delay after coordinator.connect() to allow async connection\n- Checks coordinator.isConnected before attempting data fetch\n- Shows error state immediately if connection fails\n\n**2. Timeout Protection (Line 895-913)**\n- Replaced group.notify() with group.wait(timeout: 5.0)\n- Prevents infinite loading if network requests hang\n- Shows error state on timeout\n\n**3. Connection Error UI (Line 827-881)**\n- New showConnectionError() method\n- Displays clear error message: \"Cannot Connect to Server\"\n- Provides \"Retry Connection\" button\n- Keeps \"Resume Playback\" available even when disconnected\n\n**4. Retry Mechanism (Line 883-934)**\n- New retryConnection() method\n- Shows \"Connecting...\" loading state during retry\n- Reinitializes coordinator if needed, or reconnects existing one\n- 2-second timeout to check connection status\n- On success: loads home template data\n- On failure: shows error state again\n\n### User Experience Improvements\n‚úÖ No more infinite loading spinner\n‚úÖ Clear error feedback when server unreachable\n‚úÖ One-tap retry from CarPlay (no phone interaction needed)\n‚úÖ Safe for use while driving (tap retry, don't fumble with phone)\n‚úÖ Resume playback still available even when disconnected\n\n### Testing Required (Tomorrow)\n- [ ] Test with airplane mode enabled\n- [ ] Test with VPN disconnected (Tailscale scenario)\n- [ ] Test with LMS server offline\n- [ ] Test network timeout (5s timeout triggers error)\n- [ ] Test successful retry after connection restored\n- [ ] Test Resume Playback button works in error state\n\n### Code Status\n‚úÖ Implementation complete\n‚úÖ Compiles successfully\n‚è≥ Awaiting real-world CarPlay testing","status":"open","priority":0,"issue_type":"bug","created_at":"2025-12-17T20:48:11.568123-05:00","updated_at":"2025-12-17T22:24:57.680376-05:00","labels":["bug","carplay","p0","ux"]}
{"id":"LMS_StreamTest-okt","title":"Server setup not working when using http","description":"During initial setup, HTTP connection fails with 'App Transport Security Policy requires a secure transport' error. iOS ATS blocks HTTP connections, preventing setup with HTTP-only LMS servers. Need to configure ATS exceptions or provide HTTPS option.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-11-30T19:32:22.015391-05:00","updated_at":"2025-11-30T19:32:22.015391-05:00"}
{"id":"LMS_StreamTest-owe","title":"Phase 3: Implement OUTPUT_START_AT State","description":"Add .startAt(jiffies:) case to PlaybackState enum. Implement delayed playback start logic - buffer but don't play until gettime_ms() \u003e= targetJiffies. Files: AudioPlayer.swift","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-01T20:32:50.720986-05:00","updated_at":"2025-12-01T20:44:32.930308-05:00","closed_at":"2025-12-01T20:44:32.930308-05:00","dependencies":[{"issue_id":"LMS_StreamTest-owe","depends_on_id":"LMS_StreamTest-244","type":"blocks","created_at":"2025-12-01T20:33:02.917078-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-p6j","title":"change lossless with seeking (WAV) to just Lossless (WAV) in settings menu","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T19:26:50.742806-05:00","updated_at":"2025-11-30T19:27:20.028045-05:00","closed_at":"2025-11-30T19:27:20.028045-05:00"}
{"id":"LMS_StreamTest-q0t","title":"Multiple app icon styles/themes for customization","description":"User requests multiple app icon styles and color schemes to choose from, similar to Git app's icon variations.\n\nUser specifically interested in retro wave/karaoke fantasy style to match homescreen aesthetics.\n\n## IMPLEMENTATION DECISION - December 11, 2025\n\n**Monetization Approach:** Option A - IAP Implementation\n**Price Point:** $2.99 (Icon Pack - Non-consumable IAP)\n**Product ID:** com.lyrplay.icons\n\n### Prerequisites (CRITICAL - Must Complete FIRST)\n1. Purchase BASS Shareware license at https://www.un4seen.com/\n   - Cost: ‚Ç¨125 (‚âà$135 USD)\n   - Required because adding IAPs = \"making money from product\"\n   - License covers products ‚â§‚Ç¨10 per purchase ($2.99 ‚âà ‚Ç¨2.75 ‚úÖ)\n   - Break-even: $135 √∑ $2.10 net = ~64 sales (after Apple's 30% cut)\n\n### Assets Available\n- 12 icon variants at 1024x1024 PNG in \"App Icons\" folder\n- Includes user-requested retro wave styles: Outrun, Retrowave\n- All icons: Default, Gradient Shine, Hi-Fi, Monochrome, Neon, Outrun, Red, Retrowave, Reverse Out, White, Wordmark White, Wordmark\n\n### Technical Implementation\n- iOS supports alternate icons via UIApplication.setAlternateIconName()\n- Manual Info.plist exists: LMS-StreamTest-Info.plist\n- Need to add CFBundleIcons ‚Üí CFBundleAlternateIcons configuration\n- Asset catalogs: Create 11 .appiconset folders (excluding Default/primary)\n- StoreKit 2 integration for purchase/restore functionality\n- IAP validation before allowing icon switching\n\n### Monetization Context\nSee /docs/MONETIZATION_PLAN.md for complete strategy:\n- Icon Pack is Tier 1 feature (Launch Priority)\n- Part of potential LyrPlay Pro bundle ($9.99)\n- StoreKit 2 non-consumable product type\n- Family Sharing enabled\n- Restore Purchases required\n\nGitHub issue: #34\nAuthor: bungh0l10\nOpened: Sep 26, 2025","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-30T15:01:50.101228-05:00","updated_at":"2025-12-12T18:59:21.530478-05:00","closed_at":"2025-12-12T18:59:21.530478-05:00","external_ref":"gh-34"}
{"id":"LMS_StreamTest-q0t.1","title":"Research iOS alternate icon implementation requirements and create asset catalog structure","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T22:28:12.69873-05:00","updated_at":"2025-12-12T18:59:15.864379-05:00","closed_at":"2025-12-12T18:59:15.864379-05:00","dependencies":[{"issue_id":"LMS_StreamTest-q0t.1","depends_on_id":"LMS_StreamTest-q0t","type":"parent-child","created_at":"2025-11-30T22:28:12.699022-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-q0t.2","title":"Design retro wave/karaoke fantasy app icon set with all required iOS sizes","description":"Create themed app icon sets including retro wave (80s synthwave aesthetic) and karaoke fantasy (neon lights, microphone elements). Need all iOS sizes from 16x16 to 1024x1024 with @2x/@3x variants for Retina displays.","notes":"ICON DESIGN COMPLETE - 12 variants ready\n\nSTATUS: Icons already created and ready to use!\n\nAVAILABLE ICONS (all 1024x1024 PNG):\n1. Default_opaque.png (current primary icon)\n2. Gradient Shine_opaque.png\n3. Hi-Fi_opaque.png\n4. Monochrome_opaque.png\n5. Neon_opaque.png\n6. Outrun_opaque.png (retro wave - user requested!)\n7. Red_opaque.png\n8. Retrowave_opaque.png (retro wave - user requested!)\n9. Reverse Out_opaque.png\n10. White_opaque.png\n11. Wordmark White_opaque.png\n12. Wordmark_opaque.png\n\nLOCATION: App Icons/ folder in project root\n\nSIZE: Perfect! 1024x1024 is the master size iOS needs\niOS will auto-generate all smaller sizes (@2x, @3x, etc)\n\nNEXT STEP: Create .appiconset folders for 11 alternate icons\n(excluding Default which is already primary AppIcon)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T22:28:17.112389-05:00","updated_at":"2025-12-12T18:59:15.910442-05:00","closed_at":"2025-12-12T18:59:15.910442-05:00","dependencies":[{"issue_id":"LMS_StreamTest-q0t.2","depends_on_id":"LMS_StreamTest-q0t","type":"parent-child","created_at":"2025-11-30T22:28:17.112673-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-q0t.3","title":"Add app icon selection UI to SettingsManager and SettingsView","description":"Extend SettingsManager.swift with AppIconTheme enum and selectedAppIcon property. Add new section in SettingsView.swift for icon selection with preview grid, lock indicators for premium themes, and IAP integration points.","notes":"Settings UI for Icon Pack with IAP Paywall\n\nLOCATION: SettingsView.swift - new section\n\nUI STRUCTURE:\n1. Check if purchased (PurchaseManager.shared.hasIconPack)\n2. If purchased: Show icon picker grid with all 12 icons\n3. If not purchased: Show locked preview + purchase button\n\nPURCHASE BUTTON:\n- Text: Unlock Premium Icons - Dollar 2.99\n- Action: Task { await PurchaseManager.shared.purchase(.iconPack) }\n- Show loading state during purchase\n\nICON PICKER (when unlocked):\n- LazyVGrid with 3 columns\n- Preview image for each icon (from asset catalogs)\n- Checkmark on selected icon\n- Tap to switch (calls AppIconManager)\n\nRESTORE PURCHASES:\n- Button below purchase/picker\n- Calls PurchaseManager.shared.restore()\n\nERROR HANDLING:\n- Show alert if purchase fails\n- Show alert if icon switch fails\n- Loading states for async operations","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T22:28:21.292273-05:00","updated_at":"2025-12-12T18:59:15.95111-05:00","closed_at":"2025-12-12T18:59:15.95111-05:00","dependencies":[{"issue_id":"LMS_StreamTest-q0t.3","depends_on_id":"LMS_StreamTest-q0t","type":"parent-child","created_at":"2025-11-30T22:28:21.292585-05:00","created_by":"daemon"},{"issue_id":"LMS_StreamTest-q0t.3","depends_on_id":"LMS_StreamTest-q0t.1","type":"blocks","created_at":"2025-11-30T22:28:37.566279-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-q0t.4","title":"Implement UIApplication.setAlternateIconName functionality with proper error handling","description":"Create AppIconManager.swift class with setAlternateIcon() method using UIApplication.shared.setAlternateIconName(). Include error handling for invalid icons, IAP validation before switching, and UserDefaults persistence for selection.","notes":"AppIconManager Implementation with IAP Validation\n\nFUNCTIONALITY:\n- Check PurchaseManager.hasIconPack before allowing switch\n- Use UIApplication.setAlternateIconName() for actual switch\n- Persist selected icon in UserDefaults\n- Show paywall if not purchased\n- Handle errors gracefully\n\nICON NAMES (from asset catalogs):\n- AppIcon-GradientShine\n- AppIcon-HiFi\n- AppIcon-Monochrome\n- AppIcon-Neon\n- AppIcon-Outrun (retro wave!)\n- AppIcon-Red\n- AppIcon-Retrowave (retro wave!)\n- AppIcon-ReverseOut\n- AppIcon-White\n- AppIcon-WordmarkWhite\n- AppIcon-Wordmark\n\nDEFAULT: nil = primary AppIcon\n\nINTEGRATION:\n- Called from SettingsView icon picker\n- Requires PurchaseManager.shared\n- Shows alert on successful switch (iOS system behavior)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T22:28:25.292121-05:00","updated_at":"2025-12-12T18:59:15.99114-05:00","closed_at":"2025-12-12T18:59:15.99114-05:00","dependencies":[{"issue_id":"LMS_StreamTest-q0t.4","depends_on_id":"LMS_StreamTest-q0t","type":"parent-child","created_at":"2025-11-30T22:28:25.292443-05:00","created_by":"daemon"},{"issue_id":"LMS_StreamTest-q0t.4","depends_on_id":"LMS_StreamTest-q0t.1","type":"blocks","created_at":"2025-11-30T22:28:41.676746-05:00","created_by":"daemon"},{"issue_id":"LMS_StreamTest-q0t.4","depends_on_id":"LMS_StreamTest-q0t.3","type":"blocks","created_at":"2025-11-30T22:28:55.792385-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-q0t.5","title":"Research and implement StoreKit IAP for app icon monetization (/bin/zsh.99)","description":"Implement StoreKit 2 integration with IAPManager.swift, AppIconProduct.swift, and PurchaseView.swift. Create non-consumable product 'com.lyrplay.appicons.premium' at Tier 1 pricing (/bin/zsh.99). Include receipt validation and restore purchases functionality.","notes":"StoreKit 2 Implementation for Icon Pack IAP\n\nPRICING: Dollar 2.99 (Tier 2)\nPRODUCT ID: com.lyrplay.icons\nTYPE: Non-consumable IAP\nFAMILY SHARING: Enabled\n\nBASS LICENSE REQUIRED FIRST:\n- Purchase at un4seen.com for Euro 125\n- Required before adding any IAPs to app\n- Break-even at ~64 sales (after Apple 30 percent cut)\n\nFILES TO CREATE:\n- PurchaseManager.swift (StoreKit 2 manager)\n- Feature access helpers\n- Purchase/restore functionality\n\nAPP STORE CONNECT:\n- Create product com.lyrplay.icons\n- Set Tier 2 pricing\n- Enable Family Sharing\n- Configure sandbox testing","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T22:28:29.605592-05:00","updated_at":"2025-12-12T18:59:16.033534-05:00","closed_at":"2025-12-12T18:59:16.033534-05:00","dependencies":[{"issue_id":"LMS_StreamTest-q0t.5","depends_on_id":"LMS_StreamTest-q0t","type":"parent-child","created_at":"2025-11-30T22:28:29.605939-05:00","created_by":"daemon"},{"issue_id":"LMS_StreamTest-q0t.5","depends_on_id":"LMS_StreamTest-q0t.4","type":"blocks","created_at":"2025-11-30T22:28:59.068928-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-q0t.6","title":"Test icon switching across different iOS devices and versions","description":"Comprehensive testing of icon switching functionality on different iOS versions (15.6+), device types (iPhone/iPad), and scenarios (app restart, background/foreground, IAP failures). Include UI polish for smooth transitions and loading states.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T22:28:33.689457-05:00","updated_at":"2025-12-12T18:59:16.077203-05:00","closed_at":"2025-12-12T18:59:16.077203-05:00","dependencies":[{"issue_id":"LMS_StreamTest-q0t.6","depends_on_id":"LMS_StreamTest-q0t","type":"parent-child","created_at":"2025-11-30T22:28:33.689772-05:00","created_by":"daemon"},{"issue_id":"LMS_StreamTest-q0t.6","depends_on_id":"LMS_StreamTest-q0t.5","type":"blocks","created_at":"2025-11-30T22:29:03.526123-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-q4e","title":"Phase 7: Test authentication with authenticated and non-authenticated servers","description":"Comprehensive testing of authentication feature across different scenarios.\n\nTest Cases:\n1. Non-authenticated server (no credentials needed)\n2. Authenticated server with correct credentials\n3. Authenticated server with incorrect credentials (401 handling)\n4. Authenticated server with empty credentials\n5. Primary server authenticated, backup non-authenticated\n6. Both servers authenticated with different credentials\n7. FLAC/MP3/AAC/Opus streams with authentication\n8. Server failover with authentication preserved\n9. Credential persistence across app restarts\n10. Keychain data migration/deletion\n\nTest Environment:\n- Local LMS server with HTTP auth enabled\n- Test with various audio formats\n- Test backup server failover\n- Test credential storage/retrieval\n- Verify no credentials leak to logs\n\nSuccess Criteria:\n- All streams work with correct credentials\n- 401 errors handled gracefully\n- Credentials securely stored in Keychain\n- UI clearly indicates auth status\n- No auth credentials in plaintext logs\n\nDependencies:\n- Requires all phases 1-6 complete","notes":"Phase 7 Testing - Ready for Manual Execution\n\nTESTING PLAN CREATED: docs/authentication_testing_plan.md\n\nThis comprehensive testing document covers all authentication scenarios:\n\n‚úÖ 10 Test Scenarios:\n1. Non-authenticated server (regression test)\n2. Authenticated server with correct credentials\n3. Authenticated server with wrong credentials\n4. Empty credentials on authenticated server\n5. Primary authenticated, backup non-authenticated\n6. Both servers authenticated (different credentials)\n7. All audio formats with authentication\n8. Server failover with auth preserved\n9. Credential persistence across app restarts\n10. Keychain data deletion\n\n‚úÖ Security Verification:\n- Log inspection for password leakage\n- Keychain security validation\n- Ensure no plaintext credentials in logs/files\n\n‚úÖ Success Criteria Defined:\n- Must Pass (Critical): Non-auth servers work, correct credentials work, Keychain secure, no password logs\n- Should Pass (Important): All formats work, persistence, mixed configs, failover\n- Nice to Have: Clear error messages (limited by BASS)\n\n‚úÖ Test Results Template:\n- Checklist format for each scenario\n- Overall status tracking\n- Recommendation for release approval\n\nIMPLEMENTATION STATUS:\n‚úÖ Phase 1: KeychainManager - secure credential storage\n‚úÖ Phase 1A: Research - URL-embedded credentials confirmed correct approach\n‚úÖ Phase 2: SettingsManager - auth properties with Keychain integration\n‚úÖ Phase 3: Auth header generation - generateAuthHeader() for WebView\n‚úÖ Phase 4: URL credential injection - injectCredentialsIntoURL() for streams\n‚úÖ Phase 5: Settings UI - username/password fields\n‚úÖ Phase 5A: WebView lockout prevention - 401 detection with settings fallback\n‚ö†Ô∏è Phase 6: Stream 401 handling - May not be feasible (see task notes)\n\nREADY FOR TESTING:\nAll code implementation complete. Manual testing required to verify:\n- Functionality across all scenarios\n- Security (no credential leakage)\n- Regression (non-auth servers still work)\n- User experience (error messages, persistence)\n\nNEXT STEPS AFTER TESTING:\n1. Execute test plan with real LMS servers (authenticated and non-authenticated)\n2. Fill out test results template\n3. If all pass ‚Üí Close Phase 7 and parent task (ea3)\n4. If issues found ‚Üí Create fix tasks\n5. Move to onboarding auth fields (ea3.1)\n\nTESTING REQUIREMENTS:\n- LMS server with HTTP authentication enabled\n- LMS server without authentication (for regression)\n- Physical iOS device or simulator\n- Various audio formats in library (FLAC, MP3, AAC, Opus, WAV)\n- Access to Xcode Console for log inspection\n\nESTIMATED TESTING TIME: 2-3 hours for complete test coverage","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T06:21:47.252732-05:00","updated_at":"2025-12-07T12:34:54.432713-05:00","closed_at":"2025-12-07T12:34:54.432713-05:00","dependencies":[{"issue_id":"LMS_StreamTest-q4e","depends_on_id":"LMS_StreamTest-60n","type":"blocks","created_at":"2025-12-07T06:22:02.780324-05:00","created_by":"daemon"},{"issue_id":"LMS_StreamTest-q4e","depends_on_id":"LMS_StreamTest-hqs","type":"blocks","created_at":"2025-12-07T06:22:02.851185-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-reb","title":"Add setting to disable local player volume control","description":"Add a setting in the settings menu to fix local player volume at 100% and use iOS system volume buttons instead.\n\n## Feature Request\n\n### Current Behavior\n- App has internal player volume control via LMS volume commands\n- iOS system volume controls app volume\n- Two volume controls can be confusing\n\n### Proposed Feature\nAdd toggle setting: \"Use System Volume Only\"\n\nWhen enabled:\n- Fix internal player volume at 100%\n- Disable LMS volume mixer commands\n- Let iOS system volume buttons control playback volume\n- Simpler volume control for users who prefer system-level control\n\n### Implementation Notes\n- Add toggle to Settings \u003e Audio Settings section\n- Store preference in SettingsManager (UserDefaults)\n- When enabled: Set player volume to 100 on playback start\n- When enabled: Ignore LMS volume mixer commands from server\n- MPVolumeView integration for system volume control\n\n### Benefits\n- Simpler volume control (one source of truth)\n- Avoid volume conflicts between app and system\n- Better integration with iOS volume buttons\n- User choice between app volume vs system volume\n\n### Related Code Areas\n- SettingsView.swift - Add toggle UI\n- SettingsManager.swift - Store preference\n- SlimProtoCoordinator.swift - Handle volume commands\n- AudioPlayer.swift or AudioManager.swift - Set fixed volume","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T06:01:32.705179-05:00","updated_at":"2025-12-10T06:01:32.705179-05:00"}
{"id":"LMS_StreamTest-ry5","title":"Add LAME requirement warning for MP3 capability setting","description":"## Issue\n\nUsers can enable MP3 in the Capabilities settings, but MP3 playback requires LAME encoder to be installed on the LMS server. There's currently no indication of this requirement in the UI.\n\n## Problem\n\nIf LAME is not installed on the server:\n- MP3 streams will fail to play\n- Users won't understand why MP3 doesn't work\n- No clear guidance on what's required\n\n## Solution\n\nAdd informational text/warning in Settings ‚Üí Capabilities section near the MP3 toggle:\n\n### Suggested UI Text\n\n```\n‚ÑπÔ∏è MP3 requires LAME encoder on LMS server\n```\n\nOr more detailed:\n\n```\nMP3 Playback\nRequires LAME encoder installed on your LMS server.\nMost LMS installations include LAME by default.\n\nTo verify: LMS Web ‚Üí Settings ‚Üí Advanced ‚Üí File Types\n```\n\n### Implementation Options\n\n1. **Info icon** next to MP3 toggle (tap to show alert)\n2. **Subtitle text** under MP3 capability row\n3. **Help section** in Capabilities screen\n4. **One-time alert** when user first enables MP3\n\n## Recommended Approach\n\nUse subtitle/caption text under the MP3 toggle:\n- Non-intrusive\n- Always visible when user sees MP3 setting\n- Doesn't require extra taps\n- Consistent with iOS design patterns\n\n## Files to Modify\n\n- **CapabilitiesView.swift** (or wherever capabilities settings are defined)\n- Add caption/subtitle to MP3 toggle row\n- Consider adding \"Learn More\" button linking to LMS documentation\n\n## Testing\n\n1. Verify text displays correctly in Settings ‚Üí Capabilities\n2. Test on iPhone and iPad layouts\n3. Ensure text doesn't overflow or cause layout issues\n\n## Priority\n\nP2 - UX improvement to prevent user confusion. Not blocking but important for user experience.\n\n## Related\n\n- LMS_StreamTest-fpz (MP3 transcode bitrate investigation)\n- LAME installation is standard on most LMS servers\n- Documentation should explain this requirement","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T15:28:33.752065-05:00","updated_at":"2025-12-13T15:28:33.752065-05:00"}
{"id":"LMS_StreamTest-ry8","title":"Gapless boundary drift and metadata desync on track transitions","description":"INTERMITTENT gapless boundary prediction and metadata desync issues occur during track transitions on PUSH STREAM architecture.\n\nROOT CAUSE IDENTIFIED:\nRace condition between STMs (track started) message and metadata query in sendTrackStarted().\nBoth are async network operations sent simultaneously - if metadata query reaches server BEFORE STMs is processed, server responds with STALE metadata (previous track).\n\nSPECIFIC MANIFESTATION:\n- Track 1 ends\n- Track 2 audio starts (correct)\n- Timer resets to 0:00 (correct)\n- Metadata shows Track 1 (WRONG - stuck for entire track)\n- Track 3 starts - metadata finally updates to Track 3 (skips Track 2 entirely)\n\nWHY NEW TRACKS ALWAYS WORK:\nManual skips and first track have natural timing delays (1+ seconds) between STMs and metadata query.\nGapless transitions fire both messages nearly simultaneously, creating race condition.\n\nTECHNICAL DETAILS:\nsendTrackStarted() (SlimProtoCoordinator.swift:1070) was calling:\n  1. client.sendStatus(\"STMs\") - tell server we're on new track\n  2. fetchCurrentTrackMetadata() - ask server for metadata\n  \nIf network jitter causes #2 to arrive before #1, server responds with old track metadata.\n\nFIX IMPLEMENTED:\nAdded 500ms delay before metadata query:\n  DispatchQueue.main.asyncAfter(deadline: .now() + 0.5) {\n      self.fetchCurrentTrackMetadata()\n  }\n\nThis ensures server processes STMs BEFORE responding to metadata query.\n\nFILES MODIFIED:\n- SlimProtoCoordinator.swift:1084-1092 (sendTrackStarted method)\n\nTESTING REQUIRED:\n- Gapless transitions Track 1‚Üí2‚Üí3\n- Verify metadata updates correctly for each track\n- Test on CarPlay and lock screen\n- Verify timer and metadata stay in sync","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-30T14:54:06.219403-05:00","updated_at":"2025-12-17T22:09:46.901237-05:00","closed_at":"2025-12-17T22:09:46.901237-05:00"}
{"id":"LMS_StreamTest-u4k","title":"Clean up player sync logging - remove excessive debug logs from sync implementation","description":"During sync implementation, debug logs were added to track sync behavior. These should be cleaned up now that sync is working properly. Based on feature branch commit 95d6ef5, AudioStreamDecoder.swift had 3 log statements removed. Need to review sync-related files and remove excessive debug logging while keeping essential error logs. Files to check: AudioStreamDecoder.swift, SlimProtoCoordinator.swift, AudioManager.swift, SlimProtoCommandHandler.swift","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T16:47:54.557529-05:00","updated_at":"2025-12-07T14:44:36.805076-05:00","closed_at":"2025-12-07T14:44:36.805076-05:00"}
{"id":"LMS_StreamTest-w0e","title":"Test beads setup","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T15:29:47.309598-05:00","updated_at":"2025-11-30T15:30:17.415057-05:00","closed_at":"2025-11-30T15:30:17.415057-05:00"}
{"id":"LMS_StreamTest-w77","title":"Fix App Store warning: Missing 152x152 alternate icon for iPad","description":"## App Store Connect Warning\n\n**Warning ID:** 90892\n**Severity:** Non-blocking (app still works, just a recommendation)\n\n### Full Warning Text:\n```\nMissing recommended icon. The bundle does not contain an alternate app icon for \niPad of exactly '152x152' pixels, in .png format for iOS versions \u003e= 10.0. To \nsupport older operating systems, the icon may be required in the bundle outside \nof an asset catalog. Make sure the Info.plist file includes appropriate entries \nreferencing the file.\n```\n\n**Reference:** https://developer.apple.com/documentation/bundleresources/information_property_list/cfbundleicons\n\n### Current Setup\n\nWe have 11 alternate icons, each with:\n- ‚úÖ 120x120 @2x PNG files (for iPhone)\n- ‚úÖ Asset catalog .appiconset folders (1024x1024 source)\n- ‚úÖ Info.plist CFBundleAlternateIcons entries\n\n**Missing:**\n- ‚ùå 152x152 PNG files (iPad @2x size for 76pt icon)\n- ‚ùå 167x167 PNG files (iPad Pro @2x size for 83.5pt icon)\n\n### Why It's Missing\n\niOS alternate icons documentation shows iPhone typically uses 60pt icons (120x120 @2x).\niPad uses 76pt icons (152x152 @2x) and iPad Pro uses 83.5pt icons (167x167 @2x).\n\nWe only created 120x120 files for iPhone testing.\n\n### Solution Options\n\n**Option A: Add iPad-specific icon sizes (Recommended)**\n\nFor each of the 11 alternate icons, create:\n1. 152x152 PNG (iPad @2x)\n2. 167x167 PNG (iPad Pro @2x)\n\nFiles needed:\n- AppIcon-Gradient@2x~ipad.png (152x152)\n- AppIcon-Gradient@3x~ipad.png (167x167)\n- AppIcon-HiFi@2x~ipad.png (152x152)\n- AppIcon-HiFi@3x~ipad.png (167x167)\n- ... (repeat for all 11 icons)\n\nTotal: 22 additional files\n\n**Option B: Let iOS scale from 120x120 (Current)**\n\n- App works fine, just a warning\n- iOS scales 120x120 to 152x152 automatically\n- Not ideal for image quality but acceptable\n\n**Option C: Use asset catalogs properly**\n\nInstead of individual PNG files, fully utilize .appiconset folders with all sizes:\n- 120x120 (iPhone @2x)\n- 180x180 (iPhone @3x)  \n- 152x152 (iPad @2x)\n- 167x167 (iPad Pro @2x)\n\nThis requires updating each .appiconset/Contents.json to reference multiple sizes.\n\n### Recommendation\n\n**For now:** Option B (ignore warning) - app works fine on iPad\n\n**For polish:** Option A (create iPad sizes) - better image quality\n\n**For best practice:** Option C (proper asset catalogs) - most maintainable\n\n### Implementation (Option A - Quick Fix)\n\n```bash\ncd LMS_StreamTest/LMS_StreamTest\nfor icon in Gradient HiFi Monochrome Neon Outrun Red Retro Reverse White Wordmark WordmarkWhite; do\n  # Create 152x152 for iPad @2x\n  sips -z 152 152 \"Assets.xcassets/AppIcon-${icon}.appiconset/icon.png\" \\\n    --out \"AppIcon-${icon}@2x~ipad.png\"\n  \n  # Create 167x167 for iPad Pro @2x\n  sips -z 167 167 \"Assets.xcassets/AppIcon-${icon}.appiconset/icon.png\" \\\n    --out \"AppIcon-${icon}@3x~ipad.png\"\ndone\n\n# Then add all 22 files to Xcode project with target membership\n```\n\n### Priority\n\n**P3 (Low)** - Non-blocking warning, app works fine on iPad\n- TestFlight works\n- App Store submission works\n- Just a polish/quality recommendation\n\nCan be addressed post-launch if needed.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-13T08:39:00.638138-05:00","updated_at":"2025-12-14T19:47:20.26262-05:00","closed_at":"2025-12-14T19:47:20.26262-05:00","labels":["app-store","icons"]}
{"id":"LMS_StreamTest-xvb","title":"Clean up verbose sync/PHASE 7.x debug logs before release","description":"Remove or reduce verbose debug logging messages added during Phase 7 sync implementation. Look for logs containing 'PHASE 7', 'jiffies', 'sync', 'STMl', and other sync-related debug output. Keep error logs but reduce info/debug level logging for production release. This is separate from the general sync logging cleanup task.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T16:49:24.032448-05:00","updated_at":"2025-12-07T14:44:36.843565-05:00","closed_at":"2025-12-07T14:44:36.843565-05:00"}
{"id":"LMS_StreamTest-xxe","title":"Apple Watch integration for Lyrion player control","description":"User requests Apple Watch app to control Lyrion players. Current iPeng app has Watch support but can't switch players on watch, making it limited.\n\nUser willing to contribute PR as learning opportunity for Swift development.\n\nKey requirements:\n- Control Lyrion players from Apple Watch\n- Player switching capability on watch (unlike iPeng)\n- Basic playback controls (play/pause/skip)\n- Integration with existing LyrPlay architecture\n\nGitHub issue: #51\nAuthor: magicus\nOpened: Nov 30, 2025\n\nNote: Specific feature details to be defined, but core request is Watch app for player control.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-11-30T14:55:47.852334-05:00","updated_at":"2025-11-30T14:55:47.852334-05:00","external_ref":"gh-51"}
{"id":"LMS_StreamTest-yev","title":"Test: Verify single connection on app startup (no reconnect cycle)","description":"After implementing server value tracking, verify that app startup shows only ONE connection log sequence, not connect‚Üídisconnect‚Üíreconnect. Log should show: '‚úÖ Connected to LMS' once, with no 'Restarting connection to apply new capabilities' message during initial launch.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T19:36:25.446382-05:00","updated_at":"2025-12-08T19:43:42.514273-05:00","closed_at":"2025-12-08T19:43:42.514273-05:00","dependencies":[{"issue_id":"LMS_StreamTest-yev","depends_on_id":"LMS_StreamTest-9pe","type":"blocks","created_at":"2025-12-08T19:36:55.345375-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-yg4","title":"USB DACs cannot initialize at sample rates above 48kHz","description":"USB DACs fail to operate at high sample rates (96kHz, 192kHz). Currently downsamples to 44.1kHz or 48kHz maximum even when source material is higher resolution. Related to issue #53 where FIIO KA17 DAC shows 44.1kHz output for 96kHz FLAC files.\n\n## üö® CRITICAL UPDATE - Build 4 Testing Results (Dec 2025)\n\n### Test Results from External DAC Users\n\n**Problem Found**: Fixed 192kHz rate causes UPSAMPLING and garbled audio\n\n**Tester 1 (FIIO KA17)**:\n- Playing 96kHz file\n- DAC display shows: 192kHz\n- Result: 96kHz content being UPSAMPLED to 192kHz (should play at native 96kHz)\n\n**Tester 2 (FIIO KA17)**:\n- Playing 96kHz/24-bit file\n- App shows: \"FIIO KA17 ‚Üí 192kHz\"\n- DAC actually shows: 176.4kHz\n- Result: \"Garbled mess\" audio\n- Issue: Sample rate family mismatch (44.1 base ‚Üí 192 gives 176.4kHz artifacts)\n\n### Root Cause: WRONG APPROACH\n\nOur build 4 code uses **FIXED 192kHz** for all content:\n\n\\`\\`\\`swift\n// AudioPlayer.swift:145\nlet targetRate: DWORD = 192000  // ‚ùå Forces ALL content to 192kHz\nBASS_Init(-1, targetRate, BASS_DEVICE_FREQ, nil, nil)\n\n// PlaybackSessionController.swift:156\ntry session.setPreferredSampleRate(192000)  // ‚ùå Fixed 192kHz\n\\`\\`\\`\n\n**Why this is wrong**:\n- 44.1kHz content ‚Üí upsampled to 192kHz\n- 48kHz content ‚Üí upsampled to 192kHz  \n- 96kHz content ‚Üí upsampled to 192kHz\n- Only 192kHz content plays correctly\n\n**Sample rate family issues**:\n- 44.1kHz family: 44.1, 88.2, 176.4kHz (multiples of 44.1)\n- 48kHz family: 48, 96, 192kHz (multiples of 48)\n- Forcing 44.1kHz ‚Üí 192kHz causes resampling artifacts\n- DAC may show 176.4kHz (closest 44.1 family rate to 192)\n\n## Correct Solution: Match Content Sample Rate\n\n### Option A: Dynamic Rate Based on Content\n\nSet sample rate based on actual content being played:\n\n\\`\\`\\`swift\n// When content stream is created, we know its sample rate\nfunc initializePushStream(sampleRate: Int, channels: Int) {\n    // Configure iOS session to match content rate\n    let session = AVAudioSession.sharedInstance()\n    try? session.setPreferredSampleRate(Double(sampleRate))\n    try? session.setActive(false)  // Deactivate to change rate\n    try? session.setActive(true)   // Reactivate with new rate\n    \n    // BASS already initialized - may need to match or recreate\n    // Or use BASS stream-level settings instead of device-level\n}\n\\`\\`\\`\n\n**Challenges**:\n- AVAudioSession already activated in PlaybackSessionController\n- Can't easily change session sample rate during playback\n- Would need to reinitialize for each track with different rate\n\n### Option B: Let iOS/BASS Auto-Detect (RECOMMENDED)\n\nDon't force a rate - let the system match content automatically:\n\n\\`\\`\\`swift\n// AudioPlayer.swift\n// Use 0 or 44100 as default, let BASS auto-detect from content\nlet targetRate: DWORD = 0  // Auto-detect\nBASS_Init(-1, targetRate, BASS_DEVICE_FREQ, nil, nil)\n\n// PlaybackSessionController.swift\n// Don't set preferred rate - let iOS auto-switch\n// REMOVE: try session.setPreferredSampleRate(192000)\n\\`\\`\\`\n\n**Research needed**: Does iOS auto-switch sample rates for different content?\n\n### Option C: Match Stream Rate, Not Device Rate\n\nPerhaps BASS_DEVICE_FREQ is wrong - maybe we should let device stay at default and only set stream rate?\n\n\\`\\`\\`swift\n// Initialize BASS without forcing device rate\nBASS_Init(-1, 44100, 0, nil, nil)  // No BASS_DEVICE_FREQ\n\n// Later, when creating stream, let BASS handle per-stream rate\nBASS_StreamCreate(contentRate, channels, BASS_SAMPLE_FLOAT, ...)\n// BASS will resample stream to device rate\n\\`\\`\\`\n\n**Question**: Will this preserve high-res if device stays at 48kHz?\n\n## What We Learned\n\n1. ‚úÖ BASS_DEVICE_FREQ works (BASS can request sample rates)\n2. ‚úÖ iOS setPreferredSampleRate works (iOS honors the request)\n3. ‚ùå Fixed 192kHz is WRONG - causes upsampling and artifacts\n4. ‚ùì Need to match content rate OR let system auto-detect\n\n## Investigation Needed\n\n### Test Different Approaches:\n\n**Test 1: Remove fixed 192kHz**\n- Remove setPreferredSampleRate call entirely\n- Use BASS_Init with 0 or 44100\n- See if iOS auto-switches for different content rates\n\n**Test 2: Dynamic session rate**\n- Change AVAudioSession.preferredSampleRate when content changes\n- Deactivate/reactivate session between tracks\n- Check if this works without breaking lock screen controls\n\n**Test 3: Per-stream vs device-wide**\n- Keep device at 48kHz\n- Let BASS create streams at content rate\n- Accept that BASS will resample (but at least no upsampling)\n\n### Questions for un4seen Forums:\n\n1. With BASS_DEVICE_FREQ, should we use content rate or max device rate?\n2. Does BASS auto-detect stream rate if device rate is different?\n3. How to handle multiple sample rate families (44.1 vs 48)?\n4. Best practice for iOS high-res audio with varying content rates?\n\n## Previous Research (Still Valid)\n\n[Previous research sections remain - BASS_DEVICE_FREQ flag info, iOS limitations, etc.]","notes":"RESOLVED - Build 11: Moved setPreferredSampleRate() from prefetch to stream creation. USB DACs now correctly switch to content sample rates (44.1-192kHz) at track boundaries. Tester confirmed 96kHz playback on FIIO KA17. Commit 2d8c068","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-08T20:53:55.859855-05:00","updated_at":"2025-12-14T19:44:31.186523-05:00","closed_at":"2025-12-14T19:44:31.186534-05:00"}
{"id":"LMS_StreamTest-yg4.1","title":"Add device rate check in AudioStreamDecoder.startDecodingFromURL()","description":"After line 631 (getting decoder sample rate), add BASS_GetInfo() to check current device output rate. Compare deviceRate vs actualSampleRate to determine if device reinit is needed.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":15,"created_at":"2025-12-10T18:25:36.606218-05:00","updated_at":"2025-12-10T18:27:54.489601-05:00","closed_at":"2025-12-10T18:27:54.489608-05:00","dependencies":[{"issue_id":"LMS_StreamTest-yg4.1","depends_on_id":"LMS_StreamTest-yg4","type":"parent-child","created_at":"2025-12-10T18:25:36.607103-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-yg4.2","title":"Implement BASS_DEVICE_REINIT logic for bit-perfect playback","description":"When device rate != decoder rate, call BASS_Init(-1, actualSampleRate, BASS_DEVICE_FREQ | BASS_DEVICE_REINIT, nil, nil) to change hardware output rate without destroying streams. Handle errors gracefully (hardware limitations).","status":"closed","priority":2,"issue_type":"task","estimated_minutes":30,"created_at":"2025-12-10T18:25:36.779044-05:00","updated_at":"2025-12-10T18:27:54.585468-05:00","closed_at":"2025-12-10T18:27:54.585474-05:00","dependencies":[{"issue_id":"LMS_StreamTest-yg4.2","depends_on_id":"LMS_StreamTest-yg4","type":"parent-child","created_at":"2025-12-10T18:25:36.77992-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-yg4.3","title":"Add bit-perfect verification logging","description":"Add logs showing: device rate before/after reinit, success/failure messages, hardware limitation warnings. Use distinct emoji/prefix for easy debugging.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":10,"created_at":"2025-12-10T18:25:36.951022-05:00","updated_at":"2025-12-10T18:27:54.688825-05:00","closed_at":"2025-12-10T18:27:54.68883-05:00","dependencies":[{"issue_id":"LMS_StreamTest-yg4.3","depends_on_id":"LMS_StreamTest-yg4","type":"parent-child","created_at":"2025-12-10T18:25:36.951946-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-yg4.4","title":"Test bit-perfect playback with USB DAC","description":"Test with FIIO KA17 or similar USB DAC: 96kHz FLAC (expect 96kHz on DAC), 192kHz FLAC (expect 192kHz), 44.1kHz MP3 (expect 44.1kHz). Verify DAC display shows native rates.\n\n## Critical Fix Applied (Build 11 - December 2025)\n\n### Bug Report from Tester\nWhen playing playlists with mixed sample rates (e.g., 96kHz ‚Üí 88.2kHz ‚Üí 44.1kHz):\n- Sample rate switched to NEXT track's rate during prefetching\n- Brief silence when DAC switched rates mid-track  \n- Current track got resampled to next track's rate (quality loss)\n- **Example**: Track 1 at 96kHz resampled to 88.2kHz when Track 2 started buffering\n\n### Root Cause\n`AudioStreamDecoder.startDecodingFromURL()` (line 650) called `setPreferredSampleRate()` immediately when decoder stream was created during **PREFETCHING**, not when track actually started playing.\n\n**Broken flow:**\n```\n1. Track 1 (96kHz) playing\n2. LMS prefetches Track 2 (88.2kHz) ‚Üí STRM command arrives\n3. startDecodingFromURL() ‚Üí decoder created for Track 2\n4. setPreferredSampleRate(88200) called IMMEDIATELY ‚ùå\n5. iOS audio session switches 96kHz ‚Üí 88.2kHz (Track 1 still playing!)\n6. Track 1 gets resampled, brief silence on DAC\n```\n\n### Solution (Build 11)\nMoved `setPreferredSampleRate()` from prefetch time (line 637-677) to stream creation time in `initializePushStream()` (line 354-395).\n\n**Fixed flow:**\n```\n1. Track 1 (96kHz) playing\n2. LMS prefetches Track 2 (88.2kHz) ‚Üí decoder created\n3. Format mismatch detected ‚Üí stored as pendingTrack\n4. Track 1 continues playing at 96kHz (undisturbed) ‚úÖ\n5. Track 1 finishes ‚Üí handleBufferEnd() ‚Üí startDeferredTrack()\n6. setPreferredSampleRate(88200) called NOW ‚úÖ\n7. Push stream recreated with new format\n8. Track 2 starts at 88.2kHz (clean transition)\n```\n\n### Files Changed (Commit 2d8c068)\n- **AudioStreamDecoder.swift line 637-639**: Removed premature setPreferredSampleRate() call\n- **AudioStreamDecoder.swift line 354-395**: Added to initializePushStream()\n\nNow `setPreferredSampleRate()` only called when push stream actually created:\n1. First track (AudioManager.swift:125)\n2. Format mismatch, non-gapless (AudioStreamDecoder.swift:724)  \n3. Format mismatch, gapless deferred (AudioStreamDecoder.swift:1429 in startDeferredTrack)\n\n### Testing Requirements\n‚úÖ Playlist with mixed rates: 96‚Üí88.2‚Üí44.1‚Üí96‚Üí48 kHz\n‚úÖ Sample rate changes at track boundary, not during buffering\n‚úÖ No premature resampling of current track\n‚úÖ No brief silence during playback\n‚úÖ Same sample rate tracks: No unnecessary rate changes\n‚úÖ External DAC display shows correct rate throughout each track\n\n### Technical Details\nThe fix leverages existing `pendingTrack` deferred start mechanism for gapless format mismatches. When track formats differ:\n1. New track decoder created but NOT started\n2. Stored as `pendingTrack` with sample rate info\n3. Current track plays to completion at original rate\n4. Buffer empties ‚Üí `handleBufferEnd()` triggered\n5. iOS session rate changed ‚Üí push stream recreated ‚Üí deferred track started\n6. Clean transition at track boundary\n\nThis ensures bit-perfect playback throughout each track with seamless transitions between different sample rates.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":45,"created_at":"2025-12-10T18:25:37.116323-05:00","updated_at":"2025-12-14T19:45:30.505911-05:00","closed_at":"2025-12-14T19:45:30.505911-05:00","dependencies":[{"issue_id":"LMS_StreamTest-yg4.4","depends_on_id":"LMS_StreamTest-yg4","type":"parent-child","created_at":"2025-12-10T18:25:37.117157-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-yg4.5","title":"Test gapless transitions with sample rate changes","description":"Test gapless playback: 96kHz ‚Üí 192kHz, 44.1kHz ‚Üí 96kHz. Verify device reinits correctly during track boundaries without audio dropout.\n\n## FIXED in Build 11 (December 2025)\n\n### Previous Bug\nSample rate changes occurred during **prefetching** instead of at **track boundaries**, causing:\n- Current track resampled mid-playback when next track buffered\n- Brief silence on DAC during sample rate switch\n- Quality loss from premature resampling\n\n### Fix Applied\nMoved `setPreferredSampleRate()` from `startDecodingFromURL()` (prefetch) to `initializePushStream()` (stream creation).\n\n**Commit**: 2d8c068  \n**Files**: AudioStreamDecoder.swift (lines 354-395, 637-639)\n\n### How Gapless Sample Rate Changes Work Now\n\n**Scenario: Track 1 (96kHz) ‚Üí Track 2 (88.2kHz)**\n\n1. **Track 1 playing at 96kHz**\n   - Push stream created at 96kHz\n   - iOS session at 96kHz\n   - Bit-perfect playback\n\n2. **LMS prefetches Track 2 (STRM command)**\n   - Decoder created for 88.2kHz track\n   - Format mismatch detected (96kHz stream vs 88.2kHz decoder)\n   - Track 2 stored as `pendingTrack` (NOT started)\n   - iOS session remains at 96kHz ‚úÖ\n   - Track 1 continues undisturbed\n\n3. **Track 1 finishes (buffer empties)**\n   - `handleBufferEnd()` triggered\n   - Calls `startDeferredTrack(pendingTrack)`\n\n4. **Clean transition to Track 2**\n   - `setPreferredSampleRate(88200)` called NOW\n   - Old push stream freed\n   - New push stream created at 88.2kHz\n   - iOS session switches to 88.2kHz\n   - Track 2 starts playing (bit-perfect at 88.2kHz)\n\n### Testing Checklist\n\n**Mixed Sample Rate Playlists:**\n- [ ] 96kHz ‚Üí 88.2kHz ‚Üí 44.1kHz ‚Üí 96kHz ‚Üí 48kHz\n- [ ] 192kHz ‚Üí 96kHz ‚Üí 48kHz ‚Üí 44.1kHz\n- [ ] 44.1kHz ‚Üí 48kHz ‚Üí 88.2kHz ‚Üí 96kHz ‚Üí 192kHz\n\n**Expected Behavior:**\n‚úÖ Sample rate changes ONLY at track boundaries\n‚úÖ NO resampling during prefetching\n‚úÖ NO brief silence during playback (smooth transitions)\n‚úÖ DAC display shows correct rate throughout each track\n‚úÖ True gapless playback (no audio gap at transitions)\n\n**Same Sample Rate Tracks:**\n- [ ] All 96kHz tracks (no rate changes)\n- [ ] All 44.1kHz tracks (no rate changes)\n- [ ] Verify iOS session stays at same rate throughout\n\n**Edge Cases:**\n- [ ] Very short tracks (\u003c 5 seconds) with rate changes\n- [ ] Skip to next track during prefetch (pending track handling)\n- [ ] Manual stop during prefetch (pendingTrack cleanup)\n\n### Technical Implementation\n\n**pendingTrack Mechanism:**\n```swift\nstruct PendingTrackInfo {\n    url: String\n    format: String\n    decoderStream: HSTREAM  // Keep HTTP connection alive!\n    sampleRate: Int         // New track's rate\n    channels: Int\n}\n```\n\n**Key Code Locations:**\n- `startDecodingFromURL()`: Detects format mismatch, stores pendingTrack (line 642-700)\n- `handleBufferEnd()`: Triggers deferred track start (line 1373-1391)\n- `startDeferredTrack()`: Changes iOS rate, recreates stream, starts track (line 1395-1452)\n- `initializePushStream()`: Sets iOS sample rate via setPreferredSampleRate (line 354-395)\n\n### Dependency Resolution\n\nThis fix resolves the gapless sample rate change mechanism. The task can be closed once testing confirms:\n1. No premature resampling during prefetch\n2. Clean transitions at track boundaries\n3. Bit-perfect playback maintained throughout each track\n4. Works with all sample rate combinations","status":"closed","priority":2,"issue_type":"task","estimated_minutes":30,"created_at":"2025-12-10T18:25:37.299192-05:00","updated_at":"2025-12-14T19:45:30.50851-05:00","closed_at":"2025-12-14T19:45:30.50851-05:00","dependencies":[{"issue_id":"LMS_StreamTest-yg4.5","depends_on_id":"LMS_StreamTest-yg4","type":"parent-child","created_at":"2025-12-10T18:25:37.299968-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-yg4.6","title":"Test graceful fallback on built-in audio","description":"Test with built-in speaker/AirPods: verify no crashes when hardware can't support high sample rates, verify fallback to supported rates.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":20,"created_at":"2025-12-10T18:25:37.467889-05:00","updated_at":"2025-12-14T19:45:30.509694-05:00","closed_at":"2025-12-14T19:45:30.509694-05:00","dependencies":[{"issue_id":"LMS_StreamTest-yg4.6","depends_on_id":"LMS_StreamTest-yg4","type":"parent-child","created_at":"2025-12-10T18:25:37.468666-05:00","created_by":"daemon"}]}
{"id":"LMS_StreamTest-yw7","title":"Test: Automatic failover to backup server works","description":"Verify automatic failover when primary server is unreachable. Disconnect primary server, observe app fails over to backup after 3 attempts. May see double reconnection logs (failover + .onReceive handler) but should successfully connect to backup.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T19:36:36.975373-05:00","updated_at":"2025-12-08T19:44:57.261307-05:00","closed_at":"2025-12-08T19:44:57.261307-05:00","dependencies":[{"issue_id":"LMS_StreamTest-yw7","depends_on_id":"LMS_StreamTest-9pe","type":"blocks","created_at":"2025-12-08T19:36:55.491093-05:00","created_by":"daemon"}]}
