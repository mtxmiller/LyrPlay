# Universal LyrPlay Transcoding Rules for Lyrion Media Server
# Add these rules to your LMS custom-convert.conf file for automatic LyrPlay optimization
# Works for ALL LyrPlay devices automatically - no MAC address configuration needed

# FLAC transcoding with headers for seek capability
# Enables seeking in FLAC files
flc flc LyrPlay *
	# FT:{START=--skip=%t}U:{END=--until=%v}D:{RESAMPLE=-r %d}
	[flac] -dcs $START$ $END$ --force-raw-format --sign=signed --endian=little -- $FILE$ | [sox] -q -t raw --encoding signed-integer -b $SAMPLESIZE$ -r $SAMPLERATE$ -c $CHANNELS$ -L - -t flac -r 44100 -C 0 -b 16 -

# High-quality Opus transcoding for superior bandwidth efficiency
# Modern codec optimized for mobile streaming - 256kbps provides excellent quality
flc ops LyrPlay *
	# FT:{START=--skip=%t}U:{END=--until=%v}D:{RESAMPLE=-r %d}
	[flac] -dcs $START$ $END$ --force-raw-format --sign=signed --endian=little -- $FILE$ | [sox] -q -t raw --encoding signed-integer -b $SAMPLESIZE$ -r $SAMPLERATE$ -c $CHANNELS$ -L - -t raw --encoding signed-integer -b 16 -r $SAMPLERATE$ -c $CHANNELS$ - | [opusenc] --raw --raw-bits=16 --raw-rate=$SAMPLERATE$ --raw-chan=$CHANNELS$ --bitrate=256 - -

# High-quality OGG Vorbis transcoding for bandwidth-efficient streaming
# Quality level 10 provides ~320kbps equivalent quality with smaller file sizes
flc ogg LyrPlay *
	# FT:{START=--skip=%t}U:{END=--until=%v}D:{RESAMPLE=-r %d}
	[flac] -dcs $START$ $END$ --force-raw-format --sign=signed --endian=little -- $FILE$ | [sox] -q -t raw --encoding signed-integer -b $SAMPLESIZE$ -r $SAMPLERATE$ -c $CHANNELS$ -L - -t ogg -C 10 -
